\chapter{Análisis}

\section{Análisis del sistema y requerimientos del prototipo}

A continuación, se presenta una lista con los posibles requerimientos identificados para el desarrollo del prototipo de monitoreo ambiental. Estos requerimientos están organizados en subsistemas funcionales y servirán como guía para el diseño e implementación del sistema.


En la figura \ref{Dig:diagramaAB} se presenta un diagrama a bloques que muestra el funcionamiento del sistema, la interconexión entre módulos, los componentes dentro de cada uno y las funciones de cada módulo dentro del sistema de monitoreo.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Documento/Imagenes/Análisis/DiagramaAB2 (3).pdf}
    \caption{Diagrama a bloques del sistema.}
    \label{Dig:diagramaAB}
\end{figure}
   

\subsubsection*{Módulo 1. Red inalámbrica de sensores}

\begin{enumerate}
    \item Subsistema – Sensado de parámetros de calidad del agua \\
    \begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Documento/Imagenes/Análisis/DiagramaAB2 (2).pdf}
    \caption{Diagrama a bloques del Nodeo sensor.}
    \label{Dig:diagramaAB2}
\end{figure}
    Este subsistema se encargará de obtener mediciones periódicas sobre las condiciones físico-químicas del agua mediante sensores especializados.
    \begin{itemize}
        \item Sensor de pH: permite medir el nivel de acidez del agua en intervalos definidos.
        \item Sensor de oxígeno disuelto (OD): monitorea la oxigenación del agua.
        \item Sensor de turbidez: indica la presencia de partículas suspendidas.
        \item Sensor de conductividad eléctrica: mide la concentración de iones disueltos.
        \item Sensor de temperatura: contextualiza las demás variables, ya que la temperatura afecta los valores de pH, OD y conductividad.
        \item Integración en un nodo sensor flotante: los sensores estarán integrados en un nodo con protección IP adecuada al entorno fluvial.
    \end{itemize}
    La Tabla \ref{tab:parametros_calidad_agua} presenta los rangos de medición establecidos según las recomendaciones de la Comisión Nacional del Agua (CONAGUA) \cite{conagua2022} y las Normas Oficiales Mexicanas (NOM) para análisis de agua \cite{nmx0082016, nmx0122001, nmx0382001, nmx0932000}.
    
    \input{Documento/Tablas/RangosParamCalidadAgua}

    \item Subsistema – Cámara \\
    Encargado de capturar imágenes periódicas de la superficie del agua para identificar residuos sólidos flotantes.
    \begin{itemize}
        \item Captura de imágenes: se utilizará una cámara compatible con el microcontrolador.
        \item Montaje en posición fija: las cámaras estarán orientadas hacia la superficie del agua.
        \item Iluminación diurna natural: se aprovechará la luz solar para evitar consumo energético adicional.
    \end{itemize}

    \item Subsistema – Microcontrolador \\
    Gestiona el funcionamiento de sensores, adquisición de datos, almacenamiento temporal y envío de información al servidor.
    \begin{itemize}
        \item Tarjeta de desarrollo: se empleará una tarjeta de bajo consumo energético y con capacidad de conectividad de largo alcance.
        \item Organización y empaquetado de datos: procesa, organiza y empaqueta los datos obtenidos de sensores y cámara antes de su transmisión.
        \item Manejo eficiente de energía: optimiza el consumo de energía en los nodos, considerando las limitaciones de alimentación en entornos remotos.
        \item Memoria: gestiona la memoria interna que almacenará temporalmente los datos antes de su transmisión.
    \end{itemize}

    \item Subsistema – Transceptor \\
    Encargado de transmitir los datos obtenidos por el nodo sensor al nodo vecino, y posteriormente al servidor central.
    \begin{itemize}
        \item Transmisión de datos: utiliza tecnologías de comunicación inalámbrica para garantizar conectividad en áreas remotas.
        \item Optimización del consumo energético: minimiza el consumo durante la transmisión mediante protocolos de bajo consumo.
        \item Enrutamiento de datos: gestiona la comunicación entre nodos mediante técnicas de reenvío.
    \end{itemize}

    \item Subsistema – Fuente de alimentación \\
    Este subsistema proporciona energía a todos los componentes del nodo.
    \begin{itemize}
        \item Batería: proporciona la energía necesaria para el funcionamiento completo del nodo.
        \item Panel solar: recarga la batería utilizando energía solar para garantizar autonomía en entornos remotos.
    \end{itemize}
\end{enumerate}

\subsubsection*{Módulo 2. Nodo concentrador}

El nodo concentrador cuenta con los mismos componentes que los nodos sensores, pero con la función adicional de recibir la información recolectada a través de la red. Este nodo centraliza los datos, los organiza y los transmite al servidor central para su procesamiento.

\begin{enumerate}
    \item Subsistema – Recepción de datos de nodos sensores
    \begin{itemize}
        \item Recepción de datos inalámbricos: debe recibir múltiples transmisiones periódicas para su almacenamiento temporal.
    \end{itemize}

    \item Subsistema – Almacenamiento temporal y organización de datos
    \begin{itemize}
        \item Almacenamiento temporal en buffer: los datos de los nodos se almacenan temporalmente en el buffer del concentrador.
        \item Organización de datos: se estructuran para facilitar su transmisión posterior.
    \end{itemize}

    \item Subsistema – Gateway
    \begin{itemize}
        \item Reenvío al servidor: envía los datos al servidor central mediante WLAN o red celular.
    \end{itemize}
\end{enumerate}

\subsubsection*{Módulo 3. Servidor}

\begin{enumerate}
    \item Subsistema – Recepción de datos del gateway
    \begin{itemize}
        \item Clasificación de datos: organiza y asigna metadatos a la información de sensores para su análisis.
    \end{itemize}

    \item Subsistema – Procesamiento de imágenes
    \begin{itemize}
        \item Detección de residuos: las imágenes son analizadas mediante visión artificial para identificar residuos flotantes.
        \item Marcas de detección: se agregan metadatos visuales a las imágenes para facilitar su interpretación.
    \end{itemize}

    \item Subsistema – Almacenamiento en base de datos
    \begin{itemize}
        \item Gestión de datos históricos: almacena la información adquirida para su análisis a largo plazo.
        \item Optimización de consultas: estructura la base de datos para recuperación rápida y eficiente.
    \end{itemize}

    \item Subsistema – API / Comunicación con página web
    \begin{itemize}
        \item API de comunicación: permite acceder a los datos e imágenes desde la página web.
        \item Enlace con la página web: proporciona una interfaz para que los usuarios consulten los resultados de monitoreo.
    \end{itemize}
\end{enumerate}

\subsubsection*{Módulo 4. Página web}

La página web permite consultar los datos recopilados por los nodos sensores y procesados en el servidor. Presenta información sobre calidad del agua y residuos flotantes en una interfaz responsiva.

\begin{enumerate}
    \item Subsistema – Conexión al servidor (API / Backend)
    \begin{itemize}
        \item API RESTful: gestiona solicitudes y respuestas de datos para visualización web.
        \item Conexión segura: implementa protocolos como HTTPS para proteger la transmisión de datos.
        \item Manejo de solicitudes y respuestas: estructura los datos enviados al frontend.
    \end{itemize}

    \item Subsistema – Interfaz de usuario (Frontend)
    \begin{itemize}
        \item HTML (estructura): define las secciones de visualización de datos.
        \item CSS (estilo): adapta el diseño para distintos dispositivos.
        \item JavaScript (interactividad): permite la actualización dinámica y navegación fluida.
    \end{itemize}
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%          ANALISIS REQUERIMIENTOS                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%\input{Documento/Tablas/Requerimientos}
\input{Documento/Tablas/Requerimientos2}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Analisis sensores           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Selección de Sensores}
\label{sec:analisis_sensores}
La selección de los transductores más adecuados para el sistema se rige por los requerimientos funcionales y no funcionales previamente definidos. Como base para la evaluación, cada sensor debe cumplir con las especificaciones mínimas derivadas de la Tabla~\ref{tab:parametros_calidad_agua} (Parámetros Normativos) y el requerimiento RNF01 (Precisión), las cuales se resumen a continuación:

\begin{itemize}
    \item Sensor de pH: Rango de medición mínimo de 5.0 a 8.0 unidades de pH, con una precisión de $\pm0.1$ unidades.
    
    \item Sensor de Oxígeno Disuelto: Capacidad para medir concentraciones superiores a 10~mg/L.
    
    \item Sensor de Turbidez: Rango que cubra hasta 5~UNT, con un margen de error máximo del 2\%.
    
    \item Sensor de Conductividad: Rango de hasta 1{,}000~\si{\micro\siemens\per\centi\meter}.
    
    \item Sensor de Temperatura: Cobertura del rango ambiental esperado en cuerpos de agua, típicamente de 5~a~30~\si{\celsius}.
\end{itemize}

Adicionalmente, se consideran como criterios clave la compatibilidad con una tensión de operación de 3.3--5.5~V, una interfaz de comunicación compatible con el microcontrolador seleccionado, un bajo consumo energético y un diseño robusto para inmersión continua. 

A continuación, se presenta el análisis comparativo de las opciones de mercado frente a estos criterios.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: pH                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Análisis sensores pH}
\input{Documento/Tablas/S.pH}
Para la medición de pH, se han considerado dos alternativas principales de sensores de la línea Gravity de DFRobot: el \textit{Analog pH Meter V2} y el \textit{Industrial Analog pH Meter Pro Kit V2}. Ambos dispositivos ofrecen un rango de medición de 0 a 14 pH y una precisión de $\pm$0.1 pH a 25°C, con salidas analógicas compatibles con microcontroladores basados en ESP32.

La elección definitiva entre estos sensores dependerá de la evaluación del entorno específico donde se implementará el sistema. El \textit{Analog pH Meter V2} constituye una opción económica y de fácil integración, adecuada para aplicaciones en condiciones controladas o de baja exigencia ambiental. Por su parte, el \textit{Industrial Analog pH Meter Pro Kit V2} presenta características superiores para monitoreo continuo en ambientes hostiles, como un cable de sonda de 5 metros, un diseño robusto de grado industrial y una mayor resistencia a la exposición prolongada.

Considerando que el proyecto contempla la instalación de sensores en cuerpos de agua lóticos, donde se enfrentan condiciones variables de corriente y turbidez, el \textit{Industrial Analog pH Meter Pro Kit V2} se perfila como la opción más adecuada. No obstante, la selección final será confirmada tras la validación de las condiciones ambientales específicas del sitio de prueba.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Oxigeno Disuelto            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Análisis sensores oxigeno disuelto}
\input{Documento/Tablas/S.OxigenDis}

Para la medición de oxígeno disuelto (OD) en el agua, se consideran dos opciones principales: el sensor Gravity: Analog Dissolved Oxygen Sensor (SEN0237) de DFRobot y el Atlas Scientific EZO-DO™.

El sensor Gravity Analog es una opción de bajo costo, basado en tecnología galvánica, que ofrece un rango de medición de 0 a 20 mg/L con una precisión de aproximadamente $\pm$0.2 mg/L. Su salida analógica facilita la integración con microcontroladores basados en ESP32. No obstante, presenta ciertas limitaciones para monitoreo continuo, ya que sufre interferencias por temperatura y flujo, y requiere calibraciones más frecuentes.

Por otro lado, el sensor Atlas Scientific EZO-DO™ utiliza tecnología óptica, ofreciendo un rango extendido de 0 a 50 mg/L y una alta precisión de $\pm$0.05 mg/L. Además, es adecuado para operaciones de monitoreo continuo en ambientes variables, con una mínima necesidad de calibración y una vida útil superior a los dos años. Sin embargo, su costo significativamente más elevado y su integración más compleja deben ser considerados.

Debido a que el sistema propuesto busca un equilibrio entre costos razonables y confiabilidad operativa, el sensor Gravity Analog se perfila como la opción más viable para su implementación inicial. No obstante, se mantiene abierta la posibilidad de considerar el sensor Atlas Scientific EZO-DO™ en futuras fases de ampliación o mejora del sistema, en caso de que se requiera una mayor precisión y robustez frente a condiciones ambientales extremas.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Turbidez                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Análisis sensor de turbidez}
\input{Documento/Tablas/S.turbidez}

Para la medición de turbidez en el sistema propuesto se ha seleccionado el sensor Gravity: Analog Turbidity Sensor (SKU: SEN0189) de DFRobot. Este sensor permite medir niveles de turbidez en un rango de 0 a 1000 NTU, entregando una señal analógica proporcional a la concentración de partículas suspendidas en el agua. Su compatibilidad con microcontroladores basados en ESP32, su facilidad de integración mediante conversión analógica lo hacen adecuado para el presente proyecto.

Aunque su precisión es limitada en comparación con sensores digitales o de grado industrial, y su desempeño puede verse afectado por condiciones extremas de suciedad o humedad prolongada, su bajo costo y facilidad de implementación representan una alternativa viable para una primera fase de monitoreo distribuido en cuerpos de agua lóticos. La utilización de este sensor permitirá realizar una estimación práctica del nivel de sólidos suspendidos en el agua y, de ser necesario, futuras iteraciones del sistema podrán contemplar la adopción de tecnologías más robustas.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Conductividad               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Análisis sensores conductividad}
\input{Documento/Tablas/S.conductividad}

Para la medición de conductividad eléctrica (EC) en el sistema propuesto se consideraron dos opciones: el sensor Gravity: Analog Electrical Conductivity Sensor V2 (SKU: DFR0300) de DFRobot y el Atlas Scientific EZO-EC™.

El sensor Gravity EC V2 ofrece un rango de medición de 0 a 20 mS/cm, con una precisión de $\pm$5\% de la escala completa. Su salida analógica facilita la integración directa con microcontroladores basados en ESP32, mediante el uso del convertidor analógico-digital (ADC) interno. Además, su costo accesible y su diseño robusto lo convierten en una opción viable para proyectos de monitoreo distribuido en cuerpos de agua lóticos. No obstante, requiere calibraciones periódicas utilizando soluciones estándar de conductividad, especialmente en aplicaciones de largo plazo.

En contraste, el sensor Atlas Scientific EZO-EC™ proporciona un rango extendido de hasta 200 mS/cm, alta precisión de $\pm$2\%, y mínimas necesidades de calibración. Sin embargo, su costo elevado y su integración más compleja lo hacen menos accesible para un sistema que busca un equilibrio entre funcionalidad y viabilidad económica.

Considerando los objetivos de este Proyecto y las restricciones presupuestarias, se selecciona el sensor Gravity: Analog Electrical Conductivity Sensor V2 como la opción más adecuada para la medición de conductividad, dejando abierta la posibilidad de futuras mejoras en etapas posteriores del proyecto.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Temperatura                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Análisis sensores temperatura}
\input{Documento/Tablas/S.temperatura}

Para la medición de temperatura en el sistema propuesto se consideraron dos alternativas: el sensor digital sumergible DS18B20 y el sensor industrial Atlas Scientific EZO-RTD™.

El sensor DS18B20, ampliamente utilizado en aplicaciones de monitoreo ambiental, ofrece un rango de medición de -55°C a 125°C con una precisión típica de ±0.5°C en el rango de -10°C a 85°C. Su comunicación mediante el protocolo digital 1-Wire facilita su integración directa con microcontroladores basados en ESP32. Además, su bajo costo, facilidad de adquisición y resistencia a la inmersión continua en agua lo convierten en una opción práctica y adecuada para sistemas de monitoreo distribuidos en cuerpos de agua.

Por su parte, el sensor Atlas Scientific EZO-RTD™ proporciona una mayor precisión (±0.1°C) y un rango de operación mucho más amplio, gracias al uso de sensores RTD de tipo PT-1000. Sin embargo, su alto costo y mayor complejidad de integración lo hacen menos adecuado para proyectos donde se busca un balance entre funcionalidad y viabilidad económica.

Considerando los objetivos de este Proyecto y las condiciones operativas previstas, se selecciona el sensor DS18B20 sumergible como la opción más adecuada para la medición de temperatura en cuerpos de agua lóticos.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Topologia de red            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Análisis de la topología de red}


El diseño de la Red Inalámbrica de Sensores (WSN) es fundamental para garantizar la conectividad fiable y eficiente entre los nodos distribuidos y el sistema central de procesamiento. Para este proyecto, se ha seleccionado una \textbf{topología lineal multisalto} (\textit{multi-hop linear topology}).

\subsection{Descripción de la Topología Seleccionada}
\label{subsec:descripcion_topologia}

La red se compone de cuatro nodos sensores (N=4) desplegados secuencialmente a lo largo del cuerpo de agua lótico y un nodo final denominado nodo concentrador o \textit{gateway} (\textit{sink node}), ubicado al final de la cadena. Cada nodo sensor ($n=1, ..., 4$) captura datos fisicoquímicos e imágenes. La comunicación hacia el \textit{gateway} se realiza mediante un esquema de retransmisión secuencial (\textit{store-and-forward}), donde cada nodo $n$ recibe los datos acumulados de los nodos $1$ a $n-1$ y los retransmite junto con sus propios datos hacia el nodo $n+1$ (o hacia el \textit{gateway} si $n=N$). La Figura \ref{fig:topologia_lineal_fluvial} ilustra esta configuración.

\begin{figure}[H]
   \centering
   \includegraphics[width=0.8\linewidth]{Documento/Imagenes/Análisis/Topologia/Topologia_Lineal.pdf}
   \caption{Topología lineal multisalto para el monitoreo fluvial. Los nodos sensores se comunican mediante enlaces inalámbricos (líneas discontinuas), y el Nodo Sink/Gateway se conecta a la nube mediante Wi-Fi estándar (línea sólida).}
   \label{fig:topologia_lineal_fluvial}
\end{figure}

El \textit{gateway} actúa como punto de agregación final. Recibe toda la información de la WSN a través del enlace inalámbrico proveniente del último nodo sensor (Nodo 4). Posteriormente, utiliza una interfaz de comunicación distinta, Wi-Fi estándar (IEEE 802.11n/g), para transmitir los datos consolidados al servidor central alojado en la nube. Esta elección para el enlace final (\textit{backhaul}) facilita la integración con infraestructuras de red comunes (routers Wi-Fi) para el acceso a Internet.


\subsection{Justificación de la Topología Lineal}
\label{subsec:justificacion_topologia}

La topología lineal se considera la más adecuada para el monitoreo de entornos fluviales por las siguientes razones:

\begin{itemize}
    \item \textbf{Adaptación al Entorno Geográfico:} Se alinea de forma natural con la morfología alargada de ríos y arroyos.
    \item \textbf{Monitoreo Longitudinal:} Facilita el estudio de la evolución espacial de parámetros a medida que el agua fluye.
    \item \textbf{Simplicidad de Enrutamiento:} El flujo de datos es determinista (de $n$ a $n+1$), simplificando la lógica en los nodos y ahorrando energía al evitar protocolos de enrutamiento complejos. 
\end{itemize}
Alternativas como topologías en estrella o malla presentarían desventajas en términos de alcance o complejidad para esta aplicación específica.

\subsection{Esquema de Comunicación Inter-Nodo}
\label{subsec:esquema_comunicacion_inter_nodo} 

La comunicación \textit{entre} los nodos sensores y hacia el \textit{gateway} utilizará una tecnología inalámbrica de medio alcance y bajo consumo (cuya selección se detalla en la Sección \ref{sec:analisis_tecnologias}). Esta tecnología deberá operar en modo \textit{half-duplex}, lo cual impacta el tiempo total de comunicación, como se analizó en la Sección \ref{ssubsec:tiempo_general_comm}. El esquema de retransmisión es \textit{store-and-forward}, requiriendo mecanismos básicos de fiabilidad como confirmaciones de recepción (ACK) para asegurar la entrega entre saltos.

\subsection{Implicaciones Técnicas y Limitaciones}
\label{subsec:implicaciones_topologia}

La topología lineal seleccionada presenta ciertas implicaciones:

\begin{itemize}
    \item \textbf{Carga Energética Desbalanceada:} Los nodos más cercanos al \textit{gateway} (Nodo 4) soportan mayor tráfico de retransmisión (Ecuación \eqref{eq:tiempo_comm_nodo_n}), requiriendo un dimensionamiento energético cuidadoso.
    \item \textbf{Retardo Acumulado:} Tolerable dada la baja frecuencia de muestreo semanal.
    \item \textbf{Tolerancia a Fallos Limitada:} La falla de un nodo intermedio interrumpe la cadena. Se considerarán mecanismos de detección de fallos o redundancia para futuras fases.
\end{itemize}

A pesar de la limitación en la tolerancia a fallos, la simplicidad, eficiencia y adecuación geográfica de la topología lineal la validan como la opción más pragmática para la fase actual del proyecto. La conexión final del \textit{gateway} mediante Wi-Fi estándar simplifica la integración con la infraestructura de nube.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Transceptores               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Análisis de Transceptores Inalámbricos}
\label{sec:analisis_tecnologias}

Para seleccionar la tecnología más adecuada para la transmisión de datos en el sistema de monitoreo, se evaluaron distintos estándares inalámbricos considerando tres criterios fundamentales:

\begin{enumerate}
    \item \textbf{Consumo energético}: Factor determinante para asegurar una operación prolongada mediante baterías, minimizando la necesidad de mantenimiento en zonas de difícil acceso.
    \item \textbf{Alcance efectivo}: Capacidad del protocolo para cubrir grandes distancias en una topología lineal a lo largo del río, considerando la presencia de obstáculos naturales como vegetación densa y la falta de línea de vista directa (NLOS).
    \item \textbf{Sensibilidad y Robustez}: Capacidad del receptor para decodificar señales débiles, lo cual es crítico en entornos húmedos y con vegetación que atenúan las señales de radiofrecuencia.
\end{enumerate}

La Tabla~\ref{tab:redes_corto_alcance} presenta un resumen comparativo de soluciones de red de corto alcance comúnmente utilizadas en WSN. Se incluyen tecnologías basadas en los estándares IEEE 802.15.4 y 802.15.1. Estas soluciones, aunque eficientes energéticamente, presentan limitaciones críticas de alcance ($<100$ m) para un despliegue fluvial extenso, lo que requeriría una cantidad excesiva de nodos repetidores.

\begin{table}[H]
\centering
\caption{Resumen de soluciones de red de corto alcance \cite{lopez2023}}
\label{tab:redes_corto_alcance}
\renewcommand{\arraystretch}{1.3}
\resizebox{\textwidth}{!}{
\begin{tabular}{p{2.5cm}p{2.5cm}p{2cm}p{2.5cm}p{2cm}p{1.5cm}p{2.3cm}}
\toprule
\textbf{Solution} & \textbf{Standard} & \textbf{Data rate} & \textbf{Coverage} & \textbf{Topology} & \textbf{Carrier freq} & \textbf{Energy cost} \\
\midrule
IEEE 802.15.4      & IEEE 802.15.4     & 250 kbps           & $<$100 m          & Star, tree, cluster tree, mesh & 868/915 MHz, 2.4 GHz & Low \\
ZigBee             & IEEE 802.15.4     & 250, 40, 20 kbps    & $>$100 m          & Mesh, star, tree               & 868/915 MHz, 2.4 GHz & Low \\
6LoWPAN            & IEEE 802.15.4     & 250 kbps           & $<$100 m          & Mesh, star                     & 868/915 MHz, 2.4 GHz & Low \\
Bluetooth          & IEEE 802.15.1     & 1 Mbps             & Up to 100 m       & Star, P2P                      & 2.4 GHz              & Low \\
BLE                & IEEE 802.15.1     & 1 Mbps             & Up to 200 m       & Star, P2P                      & 2.4 GHz              & Very low \\
\bottomrule
\end{tabular}
}
\end{table}

La Tabla~\ref{tab:redes_largo_alcance} complementa el análisis enfocándose en redes de medio y largo alcance (LPWAN). Se compara el estándar Wi-Fi (alto ancho de banda pero corto alcance/alto consumo) contra la tecnología LoRa. A diferencia del Wi-Fi, LoRa utiliza una técnica de modulación de espectro ensanchado (Chirp Spread Spectrum) que permite alcances de varios kilómetros y una alta inmunidad a interferencias, a costa de una tasa de transmisión reducida. Esta característica es vital para superar la atenuación por vegetación en las riberas del río.

\begin{table}[H]
\centering
\caption{Comparativa de tecnologías de medio y largo alcance\cite{lopez2023}}
\label{tab:redes_largo_alcance}
\renewcommand{\arraystretch}{1.3}
\resizebox{\textwidth}{!}{
\begin{tabular}{p{2.5cm}p{3cm}p{3cm}p{2cm}p{2.5cm}p{2cm}p{2.3cm}}
\toprule
\textbf{Tecnología} & \textbf{Estándar/Modulación} & \textbf{Tasa de Datos} & \textbf{Cobertura} & \textbf{Topología} & \textbf{Frecuencia} & \textbf{Costo Energético} \\
\midrule
Wi-Fi & IEEE 802.11 & Up to 54 Mbps & 200 m & Infrastructure, mesh & 2.4 GHz, 5 GHz & High \\
Wi-Fi HaLow & IEEE 802.11ah   & 0.15 to 4 Mbps @ 1 MHz bandwidth, an 0.65 to 7.8 Mbps @ 2 MHz bandwidth & 1000m & star, mesh & ISM Sub-GHz & Low \\ 
LoRa & CSS (Chirp Spread Spectrum) & 0.3 kbps a 50 kbps (Adaptativo) & $>$ 10 km (Rural) & Star, Mesh, P2P & Sub-GHz (915 MHz) & Muy Bajo \\ 
\bottomrule
\end{tabular}
}
\end{table}

Considerando las restricciones geográficas, en la Tabla~\ref{tab:comparativa_transceptores} se comparan módulos comerciales específicos. Se destaca el transceptor \textbf{SX1262} (integrado en la placa Heltec Wireless Tracker), que representa la generación más reciente de radios LoRa, ofreciendo mayor potencia de transmisión (+22 dBm) y menor consumo en recepción comparado con generaciones anteriores (como el SX1276) o tecnologías como Wi-Fi HaLow.

\begin{table}[H]
\renewcommand{\arraystretch}{1.5}
\centering
\caption{Comparativa de transceptores comerciales para WSN}
\label{tab:comparativa_transceptores}
\resizebox{\textwidth}{!}{
\begin{tabular}{|p{3.2cm}|C{3cm}|C{3cm}|C{3cm}|C{3cm}|C{3cm}|}
\hline
\textbf{Parámetro} 
& \shortstack{\\ \textbf{LoRa (SX1262)}\\ \textbf{(Propuesto)}} 
& \shortstack{\\ \textbf{Wi-Fi HaLow}\\ \textbf{(802.11ah)}} 
& \shortstack{\\ \textbf{Wi-Fi}\\ \textbf{(802.11n)}} 
& \shortstack{\\ \textbf{Zigbee}\\ \textbf{(802.15.4)}}
& \shortstack{\\ \textbf{Bluetooth} \\ \textbf{(802.15.1)}} \\ \hline

\textbf{Módulo/Chip} & Heltec (SX1262) \cite{semtech_sx1261_2017} & Quectel FGH100M \cite{QuectelFGH100M} & ESP32-S3 \cite{EspressifESP32S3} & XBee S2C \cite{DigiXBeeS2C} & HC-05 \cite{HC05Datasheet} \\ \hline
\textbf{Tasa Máx.} & $\sim$ 22 kbps (SF7) & 32.5 Mbps & 150 Mbps & 0.25 Mbps & 2.1 Mbps \\ \hline
\textbf{Potencia Tx} & +22 dBm & +20 dBm & +19 dBm & +5 dBm & +4 dBm \\ \hline
\textbf{Sensibilidad Rx} & -148 dBm & -98 dBm & -98 dBm & -100 dBm & -84 dBm \\ \hline
\textbf{Alcance LOS\footnote{Line Of Sight}} & $>$ 10 km & $\sim$ 1 km & 120 m & 1200 m & 40 m \\ \hline
\textbf{Consumo Tx} & 118 mA (@22dBm) & 286 mA & 286 mA & 33 mA & 30 mA \\ \hline
\textbf{Consumo Rx} & 4.2 mA & 43 mA & 95 mA & 28 mA & 30 mA \\ \hline
\textbf{Consumo Sleep} & 0.6 µA & TBD & 240 µA & 1 µA & TBD \\ \hline

\end{tabular}
}
\end{table}


En la Tabla \ref{tab:imagenes_transceptore} se presentan imágenes representativas de los módulos evaluados.

\begin{table}[H]
\renewcommand{\arraystretch}{1.5}
\centering
\caption{Ilustraciones de transceptores evaluados}
\label{tab:imagenes_transceptore}
\resizebox{\textwidth}{!}{
\begin{tabular}{|C{3.5cm}|C{3.5cm}|C{3.5cm}|C{3.5cm}|C{3.5cm}|}
\hline
 \textbf{Heltec (SX1262)} & \textbf{FGH100M} & \textbf{ESP32-S3} & \textbf{XBee S2C} & \textbf{HC-05} \\ \hline

\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/heltec_lora.png}} 
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/Xiao Halow.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/Esp32.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/zigbee.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/HC-05.jpg}}
\\ \hline
\end{tabular}
}
\end{table}

\subsection{Justificación y Estrategia de Implementación}
\label{subsec:justificacion_lora}

Con base en la comparativa anterior, se selecciona el transceptor \textbf{Semtech SX1262} como el elemento de comunicación central del sistema. Esta decisión se fundamenta en dos ventajas técnicas decisivas para el entorno fluvial: su \textbf{presupuesto de enlace superior} y su \textbf{eficiencia energética}.

Con una potencia de salida de \SI{+22}{dBm} y una sensibilidad de \SI{-148}{dBm}, el SX1262 proporciona un margen de enlace de \SI{170}{dB}, indispensable para superar la atenuación severa causada por la vegetación ribereña y la falta de línea de vista directa, condiciones donde tecnologías como Wi-Fi o Zigbee fallarían. Además, su consumo en recepción de solo \SI{4.2}{\milli\ampere} extiende significativamente la vida útil de la batería en los nodos de la red lineal, que deben permanecer en modo de escucha para retransmitir datos.

No obstante, la limitación crítica de LoRa es su ancho de banda, lo que dificulta la transmisión de archivos grandes como imágenes. Para ilustrar este desafío, se calcula el Tiempo en el Aire (ToA) requerido para transmitir una imagen de \SI{150}{\kilo\byte} (equivalente a \SI{1.23}{Mbits}) asumiendo el escenario más optimista permitido por el transceptor SX1262 ($SF=7$, $BW=\SI{500}{\kilo\hertz}$, $CR=4/5$), el cual ofrece una tasa máxima teórica de \SI{21.9}{kbps}:

\begin{equation} \label{eq:calculo_toa_imagen}
T_{ToA} \approx \frac{S_{img}}{R_{b}} = \frac{\SI{1.23}{Mbit}}{\SI{21.9}{kbit/s}} \approx \SI{56}{\second}
\end{equation}

Donde:

\begin{itemize}
    \item $T_{\mathrm{ToA}}$: Tiempo en el Aire (\textit{Time on Air}).
    \item $S_{\mathrm{img}}$: Tamaño de la imagen comprimida ($\approx \SI{150}{kB}$).
    \item $R_{b}$: Tasa de transmisión de datos efectiva (Bitrate).
\end{itemize}

Aunque un tiempo de transmisión de \SI{56}{\second} es inviable para video en tiempo real, estudios experimentales como el realizado por Jebril et al. \cite{jebril2018overcoming} han demostrado la viabilidad de transmitir imágenes JPEG sobre la capa física (PHY) de LoRa en entornos de vegetación densa (manglares), superando las limitaciones de la zona de Fresnel.

Por lo tanto, para equilibrar la robustez del enlace con la eficiencia operativa, se adopta la siguiente estrategia:
\begin{enumerate}
    \item \textbf{Transmisión de Datos de Sensores:} La transmisión periódica de los parámetros físico-químicos (pH, oxígeno disuelto, temperatura, etc.) constituye la operación base del sistema. Dado el reducido tamaño de estos datos, su transmisión se realiza con máxima eficiencia energética y mínima ocupación del canal.
    \item \textbf{Transmisión de Imágenes (Fragmentación):} Para el envío de la evidencia visual, se utiliza el protocolo de fragmentación hexadecimal validado por Jebril et al. \cite{jebril2018overcoming} para transmitir la imagen completa a través de la capa física LoRa. Se acepta el mayor costo energético temporal (\SI{\sim 118}{\milli\ampere} durante la transmisión) a cambio de garantizar que la información llegue al destino a pesar de los obstáculos del entorno.
\end{enumerate}
























\begin{comment}
\section{Análisis de Transceptores Inalámbricos}
\label{sec:analisis_tecnologias}

Para seleccionar la tecnología más adecuada para la transmisión de datos en el sistema de monitoreo, se evaluaron distintos estándares inalámbricos considerando tres criterios fundamentales:

\begin{enumerate}
    \item \textbf{Consumo energético}: Factor determinante para asegurar una operación prolongada mediante baterías, minimizando la necesidad de mantenimiento.
    \item \textbf{Alcance efectivo}: Capacidad del protocolo para cubrir distancias en una topología lineal, considerando la presencia de obstáculos naturales como vegetación y accidentes geográficos.
    \item \textbf{Tasa máxima de transmisión}: Velocidad teórica máxima con la que se pueden enviar datos, clave para asegurar el envío oportuno de lecturas y archivos, como imágenes capturadas por el sistema.
\end{enumerate}

La Tabla~\ref{tab:redes_corto_alcance} presenta un resumen comparativo de soluciones de red de corto alcance comúnmente utilizadas en aplicaciones de monitoreo ambiental con WSN. Se incluyen tecnologías basadas en los estándares IEEE 802.15.4 y 802.15.1, como ZigBee, 6LoWPAN, Bluetooth y BLE, analizando sus tasas de transmisión, topologías soportadas, rango típico de cobertura, frecuencia de operación y consumo energético. Estas soluciones priorizan eficiencia energética y bajo costo de despliegue, aunque con limitaciones en velocidad o alcance.

\input{Documento/Tablas/ResumenTecnologiasWL}


La Tabla~\ref{tab:redes_alcance_medio} complementa el análisis anterior al enfocarse en redes de alcance medio. Se comparan dos variantes del estándar IEEE 802.11: Wi-Fi tradicional y Wi-Fi HaLow (802.11ah). Aunque Wi-Fi convencional ofrece altas tasas de transferencia, su consumo energético es elevado y su cobertura limitada. En cambio, Wi-Fi HaLow opera en bandas sub-GHz, permitiendo mayor alcance, menor consumo y adecuada velocidad, lo que lo hace más apropiado para entornos remotos como cuerpos de agua lóticos.

\input{Documento/Tablas/ResumenTecnologiasWM}

Dadas las posibles soluciones, en la Tabla~\ref{tab:comparativa_transceptores} se comparan módulos transceptores comerciales representativos de cada tecnología evaluada. Se contrastan parámetros clave como tasa máxima de transmisión, potencia de transmisión y sensibilidad de recepción, alcance en línea de vista (LOS), y consumo de corriente en modos activo y en reposo. 

\input{Documento/Tablas/ComparativaTransceptores}

Esta comparativa refuerza la selección de Wi-Fi HaLow mediante el módulo FGH100M, al ofrecer un equilibrio favorable entre alcance, velocidad, consumo y viabilidad de integración en nodos autónomos. En la tabla \ref{tab:imagenes_transceptore} se presentan imágenes representativas de cada transceptor evaluado para facilitar su identificación visual.


\begin{table}[H]
\renewcommand{\arraystretch}{1.5}
\centering
\caption{Ilustraciones transceptores}
\label{tab:imagenes_transceptore}
\resizebox{\textwidth}{!}{
\begin{tabular}{|C{3.5cm}|C{3.5cm}|C{3.5cm}|C{3.5cm}|C{3.5cm}|}
\hline
 \textbf{FGH100M} & \textbf{ESP32-S3} & \textbf{XBee S2C} & \textbf{HC-05} & \textbf{Wio E5 LE} \\ \hline

\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/Xiao Halow.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/Esp32.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/zigbee.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/HC-05.jpg}}
&
\shortstack{\\ \includegraphics[width=1 \linewidth]{Documento/Imagenes/Análisis/Transceptores/Lorawan.jpg}}
\\ \hline
\end{tabular}
}
\end{table}


Como solución óptima para la transmisión bidireccional de los datos, en este caso, datos de los sensores e imagenes captadas en entornos fluviales, se propone el módulo FGH100M (Wi-Fi HaLow) como transceptor preliminar. Esta selección se fundamenta por su  exelente equilibrio entre alcance efectivo (1 km en condiciones ideales) y consumo energético moderado (54 mA en TX/43 mA en RX), características críticas para la operación prolongada en topologías lineales con nodos distribuidos. Su operación en banda sub-1 GHz (902-928 MHz) proporciona mayor penetración en vegetación ribereña comparado con soluciones en 2.4 GHz, manteniendo compatibilidad con el estándar IEEE 802.11ah para gestión adaptativa de energía mediante mecanismos TIM/RAW. Adicionalmente, soporta tasas de transferencia suficientes (32.5 Mbps) para la transmisión eficiente de datos sensoriales e imágenes comprimidas, cumpliendo con los requisitos de bidireccionalidad para recepción de comandos desde el servidor central.
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Cámaras                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Análisis de cámaras}

Para la selección de la cámara que formará parte del sistema de visión artificial, se evaluaron cuatro módulos de uso frecuente en plataformas embebidas: la OV2640, la OV5640, la Raspberry Pi Camera Module v2 y la Raspberry Pi Camera Module v3. La comparación se realizó con base en criterios como resolución, tipo de interfaz, compatibilidad con microcontroladores y computadoras de placa reducida, consumo energético, facilidad de integración y costo. Estos factores son determinantes para garantizar que el sistema sea eficiente en la captura de imágenes, considerando tanto la calidad visual necesaria para la detección de residuos sólidos flotantes en cuerpos de agua como las limitaciones energéticas y de procesamiento propias de una red de sensores. Además, la elección final también dependerá de la correspondencia entre las características de la cámara y la calidad de las imágenes disponibles en los conjuntos de datos utilizados para el entrenamiento del modelo de visión artificial, ya que la coherencia entre ambos elementos influye directamente en el desempeño del sistema.
%Para la selección de la cámara que formará parte del sistema de visión artificial, se evaluaron dos módulos ampliamente utilizados en plataformas embebidas: la OV2640 y la OV5640. La comparación se basó en criterios como resolución, tipo de interfaz, compatibilidad con microcontroladores, consumo energético, facilidad de integración y costo. Estos factores son determinantes para garantizar que el sistema sea eficiente en la captura de imágenes para la detección de residuos sólidos flotantes en cuerpos de agua.


\input{Documento/Tablas/Cámaras2}

%Ambas cámaras, OV2640 y OV5640, ofrecen características valiosas dependiendo de los requerimientos del sistema. La OV2640 es reconocida por su bajo consumo energético y facilidad de integración con microcontroladores de recursos limitados, lo que la hace adecuada para aplicaciones donde la eficiencia energética es prioritaria. La OV5640 mejora la resolución y la calidad de imagen, pero implica mayor consumo y complejidad. No obstante, debido a la necesidad de capturar imágenes de alta calidad para el análisis visual de residuos flotantes, se optó por la Raspberry Pi Camera Module 3. Esta cámara proporciona imágenes en alta resolución, mejor rendimiento en condiciones de baja iluminación y soporte para autoenfoque, lo que la convierte en la opción más adecuada para el sistema propuesto, a pesar de su mayor consumo energético.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Microcontroladores          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Análisis de microcontroladores} 
\label{sec:analisis_microcontroladores}   
La selección del microcontrolador constituye una decisión crítica en el diseño del sistema, determinando directamente las capacidades de integración sensorial, gestión energética, conectividad inalámbrica y procesamiento local de datos. Considerando los requerimientos específicos del proyecto, se llevó a cabo un análisis comparativo entre diversas placas de desarrollo ampliamente adoptadas en sistemas embebidos. Este estudio evaluó parámetros clave como arquitectura, capacidad de memoria, interfaces de comunicación, opciones de conectividad inalámbrica y costo. El objetivo fundamental es identificar la solución que optimice el equilibrio entre rendimiento computacional, eficiencia energética y viabilidad de implementación. A continuación, se presenta la comparativa técnica de las alternativas evaluadas.  

\input{Documento/Tablas/Microcontroladores2} 

\begin{table}[H]
\centering
\caption{Comparativa de microcontroladores para nodos fluviales}
\resizebox{\textwidth}{!}{
\begin{tabular}{|l|c|c|c|c|c|}
\hline
\textbf{MCU} & \textbf{Periféricos} & \textbf{Memoria} & \textbf{Consumo Activo} & \textbf{Consumo Sleep} & \textbf{Conectividad} \\ \hline
\shortstack[l]{\textbf{Heltec Wireless}\\\textbf{Tracker}} & \textbf{ADC, SPI, I2C, UART} & \textbf{8MB Flash} & \textbf{\SI{\sim 110}{\milli\ampere}} & \textbf{\SI{\sim 20}{\micro\ampere}} & \shortstack[c]{\\ \textbf{LoRa + GNSS +}  \\\textbf{Wi-Fi + BLE}} \\ \hline
Xiao ESP32-S3 & 11 GPIOs, 8 ADC & 8MB Flash & 91 mA & 240 µA & WiFi 2.4GHz + BLE \\ \hline
LilyGO T-HaLow & 36 GPIOs, 20 ADC & 16MB Flash & 91 mA & 240 µA & WiFi HaLow (900MHz) \\ \hline
RPi Pico W & 23 GPIOs, 3 ADC & 2MB Flash & 50 mA & 390 µA & WiFi 2.4GHz \\ \hline
ESP8266 NodeMCU & 17 GPIOs, 1 ADC & 4MB Flash & 80 mA & 20 µA & WiFi 2.4GHz \\ \hline
RPi Zero W & 40 GPIOs (sin ADC) & Micro SD & 2.5 A & - & WiFi 2.4GHz + BLE 4.0 \\ \hline
RPi Zero 2 W & 40 GPIOs (sin ADC) & Micro SD & 2.5 A & - & WiFi 2.4GHz + BLE 4.2 \\ \hline
\end{tabular}
}
\end{table}

Para el nodo sensor, encargado de capturar datos de sensores (pH, turbidez, oxígeno disuelto), adquirir imágenes y gestionar la comunicación de largo alcance, se selecciona la placa de desarrollo \textbf{Heltec Wireless Tracker V1.1}. Debido a la superioridad en la integración de hardware que ofrece.

Al integrar en un solo PCB el microcontrolador \textbf{ESP32-S3}, el transceptor \textbf{LoRa SX1262} y el módulo \textbf{GNSS UC6580}, se simplifica drásticamente el diseño físico del nodo y se eliminan puntos de falla asociados al cableado de módulos externos, lo cual es crítico para la robustez de un dispositivo flotante. Además, su consumo en modo de reposo es extremadamente bajo (\SI{\sim 20}{\micro\ampere}), optimizando la autonomía de la batería. Su capacidad de procesamiento es suficiente para gestionar la lectura de sensores y la compresión de imágenes, mientras que su radio LoRa integrada garantiza la conectividad en el entorno fluvial.

\begin{comment}
\subsection{Comparativa de microcontroladores PIC para control de sensores}
\label{subsec:comparativa_pic}

Dado que el Xiao ESP32-S3 Sense presenta un número limitado de pines GPIO disponibles (especialmente al estar asignados a la cámara OV5640 y al módulo Wi-Fi HaLow), se decidió incorporar un microcontrolador auxiliar dedicado exclusivamente a la gestión de sensores. Este microcontrolador debe ser de bajo consumo, tamaño reducido, fácil de programar y con recursos suficientes para:

\begin{itemize}
    \item Controlar encendido y apagado de sensores vía demultiplexor (74HC238).
    \item Leer señales analógicas mediante entradas ADC.
    \item Comunicarse con la Xiao ESP32.
    \item Mantener una operación eficiente en modo \textit{sleep}.
\end{itemize}

Con estos criterios, se evaluaron tres microcontroladores PIC de arquitectura de 8 bits con tecnología \textit{nanoWatt XLP}, comparados en la Tabla~\ref{tab:comparativa_pic}.

\begin{table}[H]
\centering
\caption{Comparativa de microcontroladores PIC para nodo sensor}
\label{tab:comparativa_pic}
\renewcommand{\arraystretch}{1.4}
\begin{tabular}{@{}|l|c|c|c|@{}}
\hline
\textbf{Característica} & \textbf{PIC12LF1822} \cite{microchip2020_PIC12LF1822_16LF1823}
                        & \textbf{PIC16LF1823} \cite{microchip2020_PIC12LF1822_16LF1823}
                        & \textbf{PIC16LF1847} \cite{microchip2013_PIC16LF1847}\\
\hline
Arquitectura         & 8-bit & 8-bit & 8-bit \\ \hline
GPIO disponibles     & 6     & 12    & 16 \\ \hline
Entradas ADC         & 4     & 8     & 12 \\ \hline
Módulo UART (EUSART) & Sí    & Sí    & Sí \\ \hline
Módulo SPI & Sí    & Sí    & Sí \\ \hline
Módulo I2C & Sí    & Sí    & Sí \\ \hline
Frecuencia máx. (MHz)& 32    & 32    & 32 \\ \hline
Consumo \textit{Sleep} & 20 nA & 20 nA & 20 nA \\ \hline
Consumo activo (@1MHz) & 30~\unit{uA} & 30~\unit{uA} & 65~\unit{uA} \\ \hline
Memoria Flash (Bytes) & 2048  & 2048  & 8192 \\ \hline
RAM (Bytes)           & 128   & 128   & 1024 \\ \hline
Tamaño encapsulado    & 8 pines & 14 pines & 28 pines \\ \hline
Precio aproximado (USD) & \$3 & \$3 & \$3 \\ \hline
\end{tabular}
\end{table}


El modelo seleccionado para el diseño del nodo es el \textbf{PIC16LF1823}, ya que representa el punto óptimo entre capacidad, eficiencia y costo:

\begin{itemize}
    \item Dispone de 11 pines GPIO, suficientes para controlar el DEMUX (3 líneas), adquirir hasta 8 señales analógicas y mantener UART dedicado.
    \item Integra un módulo EUSART que permite comunicación estable con el Xiao ESP32.
    \item Su bajo consumo en modo \textit{sleep} (20nA) y modo activo (50\unit{uA}/MHz) lo hacen ideal para sistemas alimentados por batería.
    \item Su encapsulado de 14 pines facilita el montaje en placas compactas sin sacrificar funcionalidad.
    \item Presenta compatibilidad con herramientas estándar de Microchip (MPLAB X, XC8).
\end{itemize}

En contraste, el PIC12LF1822 resulta limitado en pines y entradas ADC, mientras que el PIC16LF1847 ofrece mayores recursos a costa de un tamaño físico mayor, mayor consumo y un costo menos competitivo, innecesario para esta aplicación específica.

\end{comment}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Alimentación                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Análisis de la Alimentación}
\label{sec:analisis_alimentacion}

El sistema de monitoreo propuesto está diseñado para operar de forma autónoma en entornos naturales remotos, donde no se dispone de infraestructura eléctrica. Por ello, el subsistema de alimentación eléctrica representa un componente crítico para garantizar la continuidad operativa. La solución adoptada se basa en el uso de baterías recargables de ion-litio, complementadas con paneles solares y un módulo de gestión de carga, asegurando la autosuficiencia energética de los nodos sensores distribuidos.

\subsection{Requerimientos de Alimentación de los Componentes}
\label{subsec:reqs_alimentacion}

La Tabla~\ref{tab:componentes_energia} presenta los principales componentes seleccionados para el nodo sensor (ver secciones \ref{sec:analisis_microcontroladores} y \ref{sec:analisis_sensores}), junto con sus requerimientos estimados de voltaje y corriente de operación, extraídos de sus respectivas hojas de datos. Estos valores son fundamentales para dimensionar el sistema de alimentación.

%\input{Documento/Tablas/ConsumosElectricos}

\begin{table}[H]
\centering
\caption{Consumo eléctrico estimado de componentes del nodo sensor (Plataforma Heltec).}
\label{tab:componentes_energia}
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l S[table-format=1.1] S[table-format=3.3] l}
\toprule
\textbf{Componente} & \textbf{Modo} & {\textbf{Voltaje}} & {\textbf{Corriente}} & \textbf{Ref.} \\
 & & {(\unit{\volt})} & {(\unit{\milli\ampere})} & \\
\midrule
\multirow{3}{*}{Transceptor LoRa (SX1262)} & Tx (@ \SI{+22}{dBm}) & 3.3 & 118.0 & \cite{semtech_sx1261_2017} \\ 
 & Rx (Boosted) & 3.3 & 4.6 & \cite{semtech_sx1261_2017} \\
 & Sleep & 3.3 & <0.001 & \cite{semtech_sx1261_2017} \\
\midrule
\multirow{2}{*}{MCU ESP32-S3 (Heltec)} & Activo (Gestión) & 3.3 & 80.0 & \cite{heltec_wireless_tracker_2023} \\
 & Deep Sleep & 3.3 & 0.020 & \cite{heltec_wireless_tracker_2023} \\
\midrule
\multirow{3}{*}{GNSS (UC6580)} & Activo (Acq.) & 3.3 & 40.0 & \cite{unicore_uc6580_2023} \\ 
 & Activo (Track) & 3.3 & 40.0 & \cite{unicore_uc6580_2023} \\
 & Backup & 3.3 & 0.005 & \cite{unicore_uc6580_2023} \\
\midrule
Sensor pH (Industrial V2) & Activo & 5.0 & 10.0 & \cite{DFRobot_pH_Sensor} \\ 
Sensor OD (SEN0237) & Activo & 5.0 & 40.0 & \cite{DFRobot_DO_Sensor} \\
Sensor Turbidez (SEN0189) & Activo & 5.0 & 30.0 & \cite{DFRobot_Turbidity_Sensor} \\ 
Sensor EC (DFR0300) & Activo & 5.0 & 40.0 & \cite{DFRobot_EC_Sensor} \\
Sensor Temp (DS18B20) & Activo & 3.3 & 4.0 & \cite{DFRobot_DS18B20} \\ 
\midrule
\multirow{2}{*}{Cámara OV5640} & Activo & 3.3 & 140.0 & \cite{omnivision2011_OV5640} \\ 
 & Standby & 3.3 & 0.020 & \cite{omnivision2011_OV5640} \\
\bottomrule
\end{tabular}%
\end{table}

\begin{comment}
\begin{table}[H]
\centering
\caption{Consumo eléctrico estimado de componentes del nodo sensor.}
\label{tab:componentes_energia}
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l S[table-format=1.1] S[table-format=3.3] l}
\toprule
\textbf{Componente} & \textbf{Modo} & {\textbf{Voltaje}} & {\textbf{Corriente}} & \textbf{Ref.} \\
 & & {(\unit{\volt})} & {(\unit{\milli\ampere})} & \\
\midrule
\multirow{3}{*}{Transceptor FGH100M} & Tx & 3.3 & 54 & \cite{QuectelFGH100M} \\ 
 & Rx & 3.3 & 43 & \cite{QuectelFGH100M} \\
 & Sleep & 3.3 & <0.010 & \cite{QuectelFGH100M} \\
\midrule
\multirow{2}{*}{MCU Xiao ESP32-S3} & Activo & 3.3 & 91 & \cite{espressif2023_ESP32-S3} \\ 
 & Sleep & 3.3 & 0.240 & \cite{espressif2023_ESP32-S3} \\
\midrule
MCU PIC16LF1823 & Activo (@ \SI{1}{\mega\hertz}) & 3.3 & 0.050 & \cite{microchip2020_PIC12LF1822_16LF1823} \\ 
 & Sleep & 3.3 & <0.001 & \cite{microchip2020_PIC12LF1822_16LF1823} \\
\midrule
Sensor pH (Industrial V2) & Activo & 5.0 & 10 & \cite{DFRobot_pH_Sensor} \\ 
Sensor OD (SEN0237) & Activo & 5.0 & 40 & \cite{DFRobot_DO_Sensor} \\
Sensor Turbidez (SEN0189) & Activo & 5.0 & 30 & \cite{DFRobot_Turbidity_Sensor} \\ 
Sensor EC (DFR0300) & Activo & 5.0 & 40 & \cite{DFRobot_EC_Sensor} \\
Sensor Temp (DS18B20) & Activo & 3.3 & 4 & \cite{DFRobot_DS18B20} \\ 
\midrule
\multirow{2}{*}{Cámara OV5640} & Activo & 3.3 & 140 & \cite{omnivision2011_OV5640} \\ 
 & Standby & 3.3 & 0.020 & \cite{omnivision2011_OV5640} \\
\bottomrule
\end{tabular}
\end{table}
\end{comment}



Para estimar de forma realista el consumo energético del sistema, es indispensable cuantificar la duración efectiva de las fases de transmisión. Este análisis utiliza los parámetros de rendimiento del transceptor seleccionados en la Sección \ref{sec:analisis_tecnologias}, diferenciando entre el envío rutinario de datos de sensores y la transmisión eventual de imágenes.
\subsection{Análisis de Tiempos de Transmisión y Carga de Red}
\label{subsec:analisis_tiempos}
El diseño de la red lineal P2P con modulación LoRa impone restricciones de tiempo que deben ser calculadas paso a paso para dimensionar la batería. A continuación, se detallan los cálculos realizados para determinar el volumen de datos a transmitir y el tiempo total de comunicación por nodo.

\subsubsection*{Volumen de Datos a Transmitir}
\label{ssubsec:volumen_datos}
Cada nodo sensor genera dos tipos de información con volúmenes drásticamente diferentes:

\begin{enumerate}
    \item \textbf{Muestra sensorial y Geolocalización (Paquete de Datos):} Compuesto por las lecturas de los sensores, la ubicación y metadatos básicos.
    \begin{itemize}
        \item 4 sensores analógicos (12 bits): $4 \times \SI{12}{\bit} = \SI{48}{\bit} = \SI{6}{\byte}$
        \item 1 sensor digital (DS18B20, 12 bits): \SI{2}{\byte}
        \item Datos GNSS (Latitud, Longitud): $2 \times \SI{32}{\bit} = \SI{8}{\byte}$
        \item Metadatos (ID, Timestamp, Batería): \SI{8}{\byte}
    \end{itemize}
    \[
    \text{Volumen}_{\text{sensores}} = 6 + 2 + 8 + 8 = \boxed{\SI{24}{\byte}}
    \]

    \item \textbf{Imagen Comprimida:} Capturada por la cámara OV5640. Se asume una resolución SVGA ($800 \times 600$) con compresión JPEG estándar, resultando en un tamaño típico de archivo de \SI{\approx 150}{\kilo\byte}.
    \[
    \text{Volumen}_{\text{imagen}} \approx \boxed{\SI{150}{\kilo\byte}}
    \]
\end{enumerate}


\subsubsection*{Tiempo Total de Comunicación por Nodo en Topología Lineal}
\label{ssubsec:tiempo_general_comm}

El protocolo de comunicación implementado utiliza la modulación LoRa en una topología de red lineal P2P (multisalto). Al operar en modo \textit{half-duplex} (el transceptor no puede transmitir y recibir simultáneamente), esto tiene un impacto acumulativo en el tiempo de actividad de los nodos que actúan como repetidores.

Consideremos una red lineal con $N$ nodos sensores (numerados del 1 al $N$), donde el Nodo 1 es el más alejado del concentrador y el Nodo $N$ es el más cercano. El concentrador se considera como el destino final después del Nodo $N$.

El tiempo base ($T_{base}$) para transmitir el volumen de datos ($V_n$) generado por un solo nodo en cada ciclo se calcula como:
\begin{equation} \label{eq:tiempo_base}
T_{base} = \frac{V_n \times \SI[per-mode = symbol]{8}{\bit\per\byte}}{R}
\end{equation}
Donde:
\begin{itemize}
    \item $T_{base}$ es el tiempo base de transmisión por nodo (en segundos).
    \item $V_n$ es el volumen de datos generado por un nodo por ciclo (en bytes).
    \item $R$ es la tasa de transmisión efectiva del enlace (en bits por segundo).
\end{itemize}

Un nodo genérico $n$ (donde $1 \le n \le N$) debe recibir los datos de los $n-1$ nodos anteriores y transmitir los $n$ paquetes acumulados (los $n-1$ recibidos más el suyo). Los tiempos de recepción ($T_{rx}$) y transmisión ($T_{tx}$) para el nodo $n$ son:
\begin{equation} \label{eq:tiempo_rx_n}
T_{rx}(n) = (n-1) \times T_{base}
\end{equation}
\begin{equation} \label{eq:tiempo_tx_n}
T_{tx}(n) = n \times T_{base}
\end{equation}
Donde:
\begin{itemize}
    \item $T_{rx}(n)$ es el tiempo total de recepción para el nodo $n$ (en segundos).
    \item $T_{tx}(n)$ es el tiempo total de transmisión para el nodo $n$ (en segundos).
    \item $n$ es el índice del nodo en la cadena lineal (1 a N).
    \item $T_{base}$ es el tiempo base de transmisión por nodo, ecuación \eqref{eq:tiempo_base}.
\end{itemize}

Por lo tanto, la fórmula general para el tiempo total de comunicación activa ($T_{comm}$) para un nodo $n$ en la cadena lineal es la suma de sus tiempos de recepción y transmisión, ecuaciones \eqref{eq:tiempo_rx_n} y \eqref{eq:tiempo_tx_n}:
\begin{equation} \label{eq:tiempo_comm_nodo_n}
T_{comm}(n) = T_{rx}(n) + T_{tx}(n) = ((n-1) + n) \times T_{base} = \boxed{(2n - 1) \times T_{base}}
\end{equation}
Donde:
\begin{itemize}
    \item $T_{comm}(n)$ es el tiempo total de comunicación activa para el nodo $n$ (en segundos).
    \item $n$ es el índice del nodo en la cadena lineal (1 a N).
    \item $T_{base}$ es el tiempo base de transmisión por nodo, ecuación \eqref{eq:tiempo_base}.
\end{itemize}


\subsubsection*{Tiempo Estimado de Transmisión (Time on Air)}
\label{ssubsec:tiempo_tx}

El tiempo de transmisión se calcula con base en la tasa de datos efectiva ($R_b$) del transceptor \textbf{SX1262}. Conforme al análisis realizado en la \textbf{Sección \ref{subsec:justificacion_lora}}, se utiliza la configuración de alta velocidad (SF7, BW \SI{500}{\kilo\hertz}, CR 4/5) para minimizar el tiempo de ocupación del canal, lo que proporciona una tasa de \SI[per-mode = symbol]{21.9}{\kilo\bit\per\second}.

Bajo estas condiciones, los tiempos de actividad del radio son:

\begin{itemize}
    \item \textbf{Tiempo para Datos de Sensores y GNSS:}
    \[
    T_{\text{base\_sen}} = \frac{\SI{24}{\byte}\times \SI[per-mode = symbol]{8}{\bit\per\byte}}{\SI[per-mode = symbol]{21900}{\bit\per\second}} \approx \textbf{\SI{8.76}{\milli\second}}
    \]
    \textit{Observación:} El impacto energético de enviar el paquete de datos estándar sigue siendo despreciable, ocupando el canal por menos de \SI{10}{\milli\second}.

    \item \textbf{Tiempo para una Imagen:}
    \[
    T_{\text{base\_img}} = \frac{ 150 \times \SI[per-mode = symbol]{1024}{\byte} \times \SI[per-mode = symbol]{8}{\bit\per\byte}}{\SI[per-mode = symbol]{21900}{\bit\per\second}} \approx \textbf{\SI{56.1}{\second}}
    \]
    \textit{Observación:} La transmisión de una sola imagen requiere mantener el transceptor activo durante casi un minuto (debido a la fragmentación y envío secuencial), lo cual representa el consumo energético dominante en los ciclos donde se requiera evidencia visual.
\end{itemize}

El tiempo base total de datos generado por un nodo en cada ciclo es la suma de ambos:
\begin{equation} \label{eq:tiempo_base_calculado}
\text{T}_{\text{base}} = \text{T}_{\text{base\_sen}} + \text{T}_{\text{base\_img}} \approx \SI{8.76}{\milli\second} + \SI{56.1}{\second} \approx \boxed{\SI{56.2}{\second}}
\end{equation}

\subsubsection*{Ejemplo de Cálculo para el Nodo 4 (N=4) - Ciclo Nominal:}
En este proyecto, se tienen $N=4$ nodos sensores. El nodo más cargado es el Nodo 4, ya que debe recibir y retransmitir los datos de los 3 nodos anteriores más los propios. Aplicando la Ecuación \eqref{eq:tiempo_comm_nodo_n} con $n=4$ y utilizando el tiempo base de transmisión calculado, ecuación \eqref{eq:tiempo_base_calculado}:

\begin{equation}\label{eq:tiempo_comm_nodo4}
    T_{comm}(4) = (2 \times 4 - 1) \times \SI{56.2}{\second} = 7 \times \SI{56.2}{\second} = \SI{393.4}{\second} = \boxed{\SI{6.5}{\minute}}
\end{equation}


Este valor representa el tiempo total que el Nodo 4 pasa activo comunicándose en cada ciclo de monitoreo. A diferencia de la transmisión de solo datos sensoriales, la inclusión de imágenes incrementa significativamente el tiempo de actividad del transceptor, lo cual representa una carga energética considerable que ha sido contemplada en el dimensionamiento del sistema de alimentación.


\begin{comment}
\paragraph{Ejemplo de Cálculo para el Nodo 4 (N=4) - Ciclo Nominal:}
En este proyecto, se tienen $N=4$ nodos sensores. El nodo más cargado es el Nodo 4. Aplicando la Ecuación \eqref{eq:tiempo_comm_nodo_n} con $n=4$ y utilizando el tiempo base de transmisión de sensores $T_{base} \approx \SI{8.8}{\milli\second}$ (calculado en la subsección \ref{ssubsec:tiempo_tx}):

\[
T_{comm}(4) = (2 \times 4 - 1) \times \SI{8.8}{\milli\second} = 7 \times \SI{8.8}{\milli\second} = \boxed{\SI{61.6}{\milli\second}}
\]

Este valor representa el tiempo total que el Nodo 4 pasa activo comunicándose en cada ciclo de monitoreo estándar. Es extremadamente bajo (\SI{< 0.1}{\second}), lo cual valida la eficiencia de la topología lineal para el tráfico de sensores.

\textit{Nota: En el caso eventual de transmitir una imagen ($T_{base} \approx \SI{56}{\second}$), el tiempo acumulado para el Nodo 4 sería de $7 \times 56 \approx \SI{392}{\second}$ (\SI{\sim 6.5}{\minute}), lo que confirma la necesidad de restringir el envío de imágenes a eventos bajo demanda.}
\end{comment}


\subsection{Escenario Operativo}
\label{subsec:escenario_operativo}

Para optimizar el consumo energético y garantizar una larga autonomía, el sistema opera en un ciclo de bajo ciclo de trabajo (\textit{low duty cycle}). Se establece un \textbf{ciclo operativo semanal} (\SI{168}{\hour}) como referencia para el cálculo de autonomía base, aunque la frecuencia de muestreo puede ajustarse según la disponibilidad de energía.

Dentro de cada semana (\SI{168}{\hour}), el nodo permanece en modo de ultra bajo consumo (\textit{Deep Sleep}) la gran mayor parte del tiempo, activándose una sola vez para ejecutar la secuencia de monitoreo. Considerando el escenario más exigente (Nodo 4 retransmitiendo datos e imágenes de toda la red), los tiempos estimados son (ver Figura \ref{fig:ciclo_mod_op}):

\begin{itemize}
    \item \textbf{Adquisición de Datos}:
        \begin{itemize}
            \item Lectura de Sensores: Se asume un tiempo de estabilización y lectura de \SI{5}{\second} por cada uno de los 5 sensores. Tiempo $= 5 \times \SI{5}{\second} = \SI{25}{\second}$.
            \item Captura de Imagen: Se estima un tiempo de \SI{10}{\second} para activar la cámara, capturar y comprimir la imagen.
            \item Obtención GNSS: Se estima un tiempo promedio de \SI{10}{\second} para actualizar las coordenadas de geolocalización.
        \end{itemize}
        Tiempo total de adquisición $\approx 25 + 10 + 10 = \textbf{\SI{45}{\second}}$.

    \item \textbf{Comunicación (Nodo 4)}: Tiempo total de Tx y Rx calculado previamente, considerando la transmisión de imágenes de los 4 nodos (ver Ecuación \ref{eq:tiempo_comm_nodo4}):
    \[ T_{comm}(4) \approx \SI{393.4}{\second} \approx \textbf{\SI{6.5}{\minute}} \]

    \item \textbf{Procesamiento Local}: Tiempo adicional para gestión del buffer, fragmentación de paquetes y lógica de control. Se estima conservadoramente en \SI{5}{\second}.

    \item \textbf{Tiempo Activo Total por Ciclo}: 
    \[ \SI{45}{\second} + \SI{393.4}{\second} + \SI{5}{\second} = \SI{443.4}{\second} \approx \textbf{\SI{7.4}{\minute}} \]

    \item \textbf{Tiempo en Modo Sleep por Semana}:
    \[ \SI{168}{\hour} - \SI{7.4}{\minute} \approx \textbf{\SI{167.88}{\hour}} \]
    Esto representa que el sistema permanece en reposo el \textbf{99.93\%} del tiempo, lo cual garantiza una eficiencia energética considerable.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{Documento/Imagenes/Análisis/ciclo_modos_op.pdf}
    \caption{Ciclo simplificado de modos operativos del nodo sensor.}
    \label{fig:ciclo_mod_op}
\end{figure}


\subsection*{Cálculo del Consumo Energético Semanal}
\label{subsec:calculo_consumo}

Utilizando los tiempos de operación estimados para cada modo y las corrientes de consumo de la Tabla \ref{tab:componentes_energia}, se calcula el consumo energético total por ciclo semanal ($E_{\text{sem}}$) para el nodo más demandante (Nodo 4). La fórmula general es:

Dado que el ciclo ocurre una sola vez por semana, el cálculo se simplifica a la energía de un evento activo más la energía de reposo de toda la semana.

\begin{equation} \label{eq:energia_semanal}
E_{\text{sem}} = \sum_{\text{modo}} (I_{\text{modo}} \times t_{\text{modo}})
\end{equation}

Para la fase de comunicación del Nodo 4, se separan los tiempos y corrientes de recepción (Rx) y transmisión (Tx) calculados con la ecuación \eqref{eq:tiempo_rx_n} y \eqref{eq:tiempo_tx_n}:
\begin{itemize}
    \item Tiempo de Recepción ($T_{rx}(4)$) = \SI{168.6}{\second}
    \item Tiempo de Transmisión ($T_{tx}(4)$) = \SI{224.8}{\second}
\end{itemize}
Las corrientes totales durante estas fases son:
\begin{itemize}
    \item Corriente en Rx ($I_{Rx}$) = $I_{\text{ESP32\_activo}} + I_{\text{SX1262\_Rx}} = \SI{80}{\milli\ampere} + \SI{4.6}{\milli\ampere} = \SI{84.6}{\milli\ampere}$
    \item Corriente en Tx ($I_{Tx}$) = $I_{\text{ESP32\_activo}} + I_{\text{SX1262\_Tx}} = \SI{80}{\milli\ampere} + \SI{118}{\milli\ampere} = \SI{198}{\milli\ampere}$
\end{itemize}

La Tabla \ref{tab:consumo_detallado_semanal} detalla el cálculo completo.
\sisetup{exponent-mode=engineering}
\begin{table}[H]
\centering
\caption{Cálculo detallado del consumo energético semanal (Nodo 4, 1 ciclo/semana).}
\label{tab:consumo_detallado_semanal}
\renewcommand{\arraystretch}{1.3}
\resizebox{\textwidth}{!}{%
\begin{tabular}{l C{2cm} C{2.1cm} c c c}
\toprule
\textbf{Modo Operativo}&\multicolumn{2}{c}{\shortstack[c]{\textbf{Componentes}\\\textbf{activos}}}& \textbf{Corriente Total} & \textbf{Tiempo Semanal} & \textbf{Energía Semanal} \\
 &&& {(\unit{\milli\ampere})} & {(\unit{\hour})} & {(\unit{\milli\ampere\hour})} \\
\midrule
Lectura Sensores& \makecell[c]{ESP32 \\ 80 mA}& \makecell[c]{Sensor \\ 40 mA} & 120.0 & $25/3600 \approx \num{0.00694}$ & $\approx \num{0.8328}$ \\
Posición GNSS &\makecell[c]{ESP32 \\ 80 mA} & \makecell[c]{UC6580 \\ 40 mA} & 120.0 & $10/3600 \approx \num{0.00277}$ & $\approx \num{0.3324}$ \\
\midrule
Captura de Imagen &\makecell[c]{ESP32 \\ 80 mA} & \makecell[c]{Cam \\ 140 mA} & 220.0 & $10/3600 \approx \num{0.00277}$ & $\approx \num{0.6094}$ \\
Procesamiento Local&\makecell[c]{ESP32 \\ 80 mA}& -& 80.0 & $5/3600 \approx \num{0.00138}$ & $\approx \num{0.1104}$ \\
\midrule
Recepción &\makecell[c]{ESP32 \\ 80 mA} & \makecell[c]{SX1262\_Rx \\ 4.6 mA} & 84.6 & $168.6/3600 \approx \num{0.0468}$ & $\approx \num{3.959}$ \\
\midrule
Transmisión &\makecell[c]{ESP32 \\ 80 mA} & \makecell[c]{SX1262\_Tx \\ 118 mA} & 198.0 & $224.8/3600 \approx \num{0.0624}$ & $\approx \num{12.355}$ \\
\midrule
Modo Sleep &\multicolumn{2}{c}{Todo en sleep/standby}& 0.046 & $167.88$ & $\approx 7.722$ \\
\midrule
\textbf{Total Semanal}&& & & \textbf{168.0 h} & \textbf{$\approx \textbf{\SI{25.921}{\milli\ampere\hour}}$ }\\
\bottomrule
\end{tabular}
}
\end{table}

El análisis arroja un consumo energético semanal de \SI{25.921}{\milli\ampere\hour} para el nodo crítico. Este resultado demuestra que la adopción de un ciclo de trabajo de baja frecuencia es una medida eficaz para asegurar la sostenibilidad energética del sistema.

\subsection{Análisis y Selección de Componentes de Alimentación}
\label{subsec:seleccion_hardware_alimentacion}

Basándose en el consumo energético semanal estimado de \SI{25.921}{\milli\ampere\hour}, se procede a seleccionar los componentes del subsistema de alimentación: batería, panel solar y módulo de carga, buscando un balance entre capacidad, eficiencia, costo y seguridad.

\subsubsection{Análisis y Selección de la Batería}
La elección de la batería recargable es crucial para la autonomía del nodo. Se compararon opciones Li-ion y LiPo disponibles comercialmente (Tabla \ref{tab:baterias}), considerando capacidad, ciclos de vida, seguridad (presencia de BMS) y dimensiones.

% --- Tabla Comparativa Baterías ---
\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{4.2cm}|c|c|c|}
\caption{Comparativa de baterías recargables para el nodo sensor}
\label{tab:baterias} \\
\hline
\textbf{Característica} & \textbf{104050} \cite{batteryLipo104050}
                        & \textbf{18650 2200mAh} \cite{batteryLiIon18650}
                        & \textbf{18650 3000mAh} \cite{batteryLiIon18650} \\
\hline
\endfirsthead

\hline
\textbf{Característica} & \textbf{104050} \cite{batteryLipo104050}
                        & \textbf{18650 2200mAh} \cite{batteryLiIon18650}
                        & \textbf{18650 3000mAh} \cite{batteryLiIon18650} \\
\hline
\endhead

\hline
\multicolumn{4}{r}{\textit{Continúa en la siguiente página}} \\
\endfoot

\hline
\endlastfoot

Tipo de batería & LiPo & Li-ion & Li-ion \\
\hline
Capacidad (mAh) & 2500 & 2200 & 3000 \\
\hline
Voltaje nominal (V) & 3.7 & 3.7 & 3.7 \\
\hline
Corriente máxima de descarga (A) & 2.5 & 2.2 & 3 \\
\hline
Dimensiones (mm) & 50x40x10 & 18x65 & 18x65 \\
\hline
Peso (g) & 44 & 43 & 46 \\
\hline
Número de ciclos de carga & $>800$ & $>1000$ & $>1000$ \\
\hline
Protección integrada (BMS) & Sí & No & No \\
\hline
Precio aproximado (MXN) & \$150 & \$80 & \$100 \\
\hline
Imagen 
& \shortstack{\\ \includegraphics[scale=0.1]{Documento/Imagenes/Análisis/Bat-Pan/Bateria-104050.jpg}}
& \shortstack{\\ \includegraphics[scale=0.11]{Documento/Imagenes/Análisis/Bat-Pan/Bateria-18650-2200mAh.jpg}}
& \shortstack{\\ \includegraphics[scale=0.1]{Documento/Imagenes/Análisis/Bat-Pan/Bateria-18650-3000mAh.jpg}} \\
\end{longtable}


 Se selecciona la batería \textbf{LiPo modelo 104050} con una capacidad nominal de \SI{2500}{\milli\ampere\hour}. Aunque las celdas Li-ion 18650 ofrecen un mayor número de ciclos de vida teóricos, la LiPo seleccionada presenta dos ventajas clave para este proyecto:
\begin{enumerate}
    \item \textbf{Seguridad Integrada:} Incluye un circuito de protección (BMS - Battery Management System) incorporado, que previene sobrecargas, sobredescargas y cortocircuitos, crucial para un dispositivo autónomo desatendido \cite{batteryLipo104050}.
    \item \textbf{Capacidad Suficiente:} Sus \SI{2500}{\milli\ampere\hour} exceden ampliamente la demanda energética calculada, proporcionando un gran margen de seguridad.
\end{enumerate}
La opción Li-ion 18650 requeriría un BMS externo, añadiendo complejidad al diseño.

\paragraph*{Cálculo de Autonomía Teórica:} 

Con la batería seleccionada, la autonomía estimada sin recarga solar es:
\begin{equation} \label{eq:autonomia}
\text{Autonomía} = \frac{\text{Capacidad Batería}}{\text{Consumo Semanal}} = \frac{\SI{2500}{\milli\ampere\hour}}{\SI{25.921}{\milli\ampere\hour / \text{sem}}} \approx \boxed{\num{96.4}~\text{semanas}} \approx \num{675}~\text{días}
\end{equation}
Este cálculo sugiere una autonomía teórica de \textbf{casi dos años} (aprox. 1.8 años), ofreciendo una excelente resiliencia ante periodos prolongados sin sol.

\subsubsection{Análisis y Selección del Panel Solar}
Para garantizar la operación continua, se necesita un panel solar que reponga el consumo energético. Se evaluaron paneles compactos (Tabla \ref{tab:paneles_solares}) en función de su potencia, voltaje/corriente de salida y dimensiones.

\begin{table}[H]
\centering
\renewcommand{\arraystretch}{1.5}
\caption{Comparativa de paneles solares para el nodo sensor}
\label{tab:paneles_solares}
\begin{tabular}{|p{4cm}|c|c|c|}
\hline
\textbf{Característica} & \textbf{Panel 5V} \cite{panelSolar5V}
                        & \textbf{Panel 6V} \cite{panelSolar6V}
                        & \textbf{Panel 12V} \cite{panelSolar12V} \\
\hline
Potencia nominal (W) & 1.9 & 1.92 & 3 \\\hline
Corriente de salida (mA) & 320 & 320 & 250 \\
\hline
Voltaje de salida (V) & 5 & 6 & 12 \\
\hline
Medición de intensidad de luz & \multicolumn{3}{|c|}{38000 LUX} \\
\hline
Dimensiones (mm) & 135x130 & 104x140 & 145x145 \\
\hline
Peso (g) & 65 & 54 & 34 \\
\hline
Precio aproximado (USD) & \$6 & \$5 & \$7 \\
\hline
Imagen 
&\shortstack{\\ \includegraphics[scale = 0.1]{Documento/Imagenes/Análisis/Bat-Pan/PanelSolar-5V.jpg}}
& \shortstack{\\ \includegraphics[scale = 0.1]{Documento/Imagenes/Análisis/Bat-Pan/Panel-Solar-6V.jpg}}
& \shortstack{\\ \includegraphics[scale = 0.1]{Documento/Imagenes/Análisis/Bat-Pan/Panel-Solar-12V.jpg}} \\
\hline
\end{tabular}
\end{table}

Se selecciona el \textbf{Panel Solar de \SI{6}{\volt} / \SI{1.92}{\watt}}. Aunque el panel de \SI{5}{\volt} ofrece características similares, el voltaje ligeramente superior del panel de \SI{6}{\volt} proporciona un mayor margen para la caída de tensión y es óptimo para módulos de carga como el CN3065, que requieren un voltaje de entrada superior al de la batería \cite{chipCN3065}. Además, este modelo es el más compacto y económico de las opciones evaluadas \cite{panelSolar6V}. El panel de \SI{12}{\volt} está sobredimensionado y es menos eficiente para cargar una batería de \SI{3.7}{\volt} con un cargador simple.

\paragraph*{Análisis de Generación vs. Consumo:}
\begin{itemize}
    \item Consumo Diario Promedio: $\SI{25.921}{\milli\ampere\hour} / 7\,\text{días} \approx \SI{3.7}{\milli\ampere\hour / \text{día}}$.
    \item Generación Diaria Estimada: Asumiendo un promedio conservador de \textbf{3 horas} de sol directo equivalente por día (HSP - Horas Solares Pico) para la Ciudad de México \cite{solarGIS}, la energía generada es:
    \begin{equation} \label{eq:generacion_diaria}
    \text{Generación}_{\text{diaria}} = I_{\text{mp}} \times \text{HSP} = \SI{320}{\milli\ampere} \times \SI{3}{\hour} = \SI{960}{\milli\ampere\hour}
    \end{equation}
\end{itemize}
El excedente energético diario ($\text{Generación}_{\text{diaria}} - \text{Consumo}_{\text{diario}} \approx \SI{956.3}{\milli\ampere\hour}$) es extremadamente amplio (más de 250 veces el consumo diario), lo que garantiza la recarga completa de la batería incluso bajo condiciones de irradiación solar subóptimas (días nublados, sombra parcial). El tiempo teórico necesario para reponer el consumo de una semana completa con sol directo sería mínimo: $\SI{25.92}{\milli\ampere\hour} / \SI{320}{\milli\ampere} \approx \SI{0.08}{\hour} \approx \SI{5}{\minute}$.


\subsubsection{Análisis de módulos de carga}

El módulo de carga es el componente encargado de gestionar la recarga segura de la batería desde el panel solar. Su función principal es proteger la batería contra sobrecargas, sobredescargas y controlar el flujo de corriente, lo cual es esencial para extender su vida útil. Esta subsección presenta una comparativa entre distintos módulos de carga compatibles con baterías Li-ion o LiPo, considerando su capacidad de carga, compatibilidad con paneles solares, protección integrada y facilidad de integración con el sistema(Tabla \ref{tab:modulos_carga}).

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{4.5cm}|c|c|c|}
\caption{Comparativa de módulos de carga para baterías recargables}
\label{tab:modulos_carga} \\
\hline
\textbf{Característica} & \textbf{CN3065} \cite{chipCN3065}
                        & \textbf{SD05CRMA} \cite{SD05CRMA}
                        & \textbf{CN3791} \cite{chipCN3791} \\
\hline
\endfirsthead

\hline
\textbf{Característica} & \textbf{CN3065} \cite{chipCN3065}
                        & \textbf{SD05CRMA} \cite{SD05CRMA}
                        & \textbf{CN3791} \cite{chipCN3791} \\
\hline
\endhead

\hline
\multicolumn{4}{r}{\textit{Continúa en la siguiente página}} \\
\endfoot

\hline
\endlastfoot

Tipo de batería compatible & Li-ion/Li-Po & Li-ion/Li-Po & Li-ion \\
\hline
Voltaje de entrada (V) & 4.4 - 6 & 4.4 - 6 & 4.5 - 28 \\
\hline
Corriente máxima de carga (mA) & 1000 & 1000 & 4000 \\
\hline
Protección integrada (sobre/descarga) & Sí & Sí & Sí \\
\hline
Compatibilidad con panel solar & Sí & Sí & Sí \\
\hline
Tamaño (mm) & 40x20x7 & 10.3x18.3 & 45x20 \\
\hline
Precio aproximado (USD) & \$2 & \$3 & \$4 \\
\hline
Imagen 
& \includegraphics[scale=0.1]{Documento/Imagenes/Análisis/Bat-Pan/Cargador-Solar.jpg}
& \includegraphics[scale=0.17]{Documento/Imagenes/Análisis/Bat-Pan/Cargador-SD05CRMA.jpg}
& \includegraphics[scale=0.1]{Documento/Imagenes/Análisis/Bat-Pan/Cargador-CN3791.jpg} \\
\end{longtable}

Se selecciona el módulo basado en el chip \textbf{CN3065}. Este circuito integrado está específicamente diseñado para la carga de baterías de litio de una celda directamente desde paneles solares de bajo voltaje (\SIrange{4.4}{6}{\volt}), coincidiendo perfectamente con el panel seleccionado \cite{chipCN3065}. Incluye las protecciones esenciales (sobrecarga, sobredescarga a través de pines dedicados si se usa un IC externo) y regula la corriente de carga (hasta \SI{500}{\milli\ampere}), lo cual es adecuado para la corriente generada por el panel (\SI{320}{\milli\ampere}).

Los módulos basados en el popular chip TP4056, aunque económicos, están optimizados para carga a través de USB (\SI{5}{\volt}) y no manejan de forma nativa la variabilidad de voltaje de un panel solar \cite{chipTP4056}. El módulo CN3791, si bien incluye MPPT (Maximum Power Point Tracking) para maximizar la extracción de energía del panel, representa una complejidad y costo innecesarios dado el enorme excedente energético ya calculado; el MPPT es más beneficioso en sistemas con paneles más grandes o consumos mucho más ajustados \cite{chipCN3791}. Por lo tanto, el CN3065 ofrece la solución más simple, económica y adecuada para este sistema.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Cálculo de residuos         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Análisis de la medición de residuos sólidos flotantes}
\label{sec:analisis_medicion_residuos}

La acumulación de residuos sólidos flotantes representa un problema crítico en cuerpos de agua lóticos, actuando como vectores de transporte de contaminantes. Para su evaluación, se toma como referencia la metodología de ``observación visual'' establecida en las guías operacionales de la UNEP/IOC para la basura marina \cite{cheshire2009directrices}, adaptándola al contexto fluvial y a las restricciones del sistema IoT.

La estrategia de monitoreo se fundamenta en tres pilares:
\begin{itemize}
    \item \textbf{Captura Programada:} Utilización de cámaras fijas para obtener una "instantánea" semanal del estado de la superficie del agua, permitiendo el seguimiento de tendencias a largo plazo sin saturar el ancho de banda de la red.
    \item \textbf{Área de Muestreo Definida:} Definición de un Campo de Visión (FoV) constante sobre la superficie del río, estableciendo un área de referencia ($A_{obs}$) para los cálculos.
    \item \textbf{Procesamiento Automatizado:} Aplicación de algoritmos de segmentación de instancias para cuantificar la superficie ocupada por los residuos.
\end{itemize}

\subsection{Cálculo de la Densidad de Cobertura}
\label{subsec:calculo_densidad}

Aprovechando la capacidad del modelo de IA seleccionado para delimitar el contorno preciso de los objetos (segmentación), se define como métrica principal la \textbf{Densidad de Cobertura de Residuos} ($D_{cob}$).

Este indicador cuantifica la proporción de la superficie del cuerpo de agua que se encuentra obstruida por materiales sólidos, proporcionando una medida directa del impacto visual y ambiental. Se calcula mediante la siguiente expresión:

\begin{equation} \label{eq:densidad_cobertura}
D_{cob} = \left( \frac{A_{residuos}}{A_{obs}} \right) \times 100
\end{equation}

Donde:
\begin{itemize}
    \item $D_{cob}$: Densidad de cobertura (expresada en porcentaje $\%$).
    \item $A_{residuos}$: Sumatoria del área de todos los píxeles clasificados como ``residuo'' por la máscara de segmentación. Representa la superficie física real ocupada por la basura.
    \item $A_{obs}$: Área superficial total del río observada por la cámara (constante determinada por la calibración geométrica).
\end{itemize}
El uso de esta métrica basada en segmentación ofrece una ventaja significativa sobre el simple conteo de objetos, ya que permite diferenciar, por ejemplo, entre un río con 50 botellas dispersas y uno con una gran isla de basura compacta. Esta distinción facilita una evaluación más precisa de la magnitud real de la contaminación y ayuda a identificar zonas críticas de acumulación de manera más efectiva que los métodos de conteo tradicionales. No obstante, es necesario considerar que factores externos, como la iluminación ambiental o la reflectancia de los materiales, pueden introducir incertidumbre en la estimación del parámetro $A_{residuos}$.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Servidores                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Análisis de Servidor}

El servidor constituye el núcleo central de la arquitectura del sistema, operando bajo el modelo cliente-servidor, donde actúa como proveedor de recursos y servicios para los nodos de la red y la interfaz web \cite{supermicro2024}. La selección de una plataforma de servidor adecuada es crítica para garantizar la escalabilidad, fiabilidad y rendimiento del sistema, especialmente considerando el procesamiento de imágenes y la gestión de series temporales de datos.

El análisis se centra en dos modelos de despliegue principales: servidores locales (\textit{on-premise}) y servidores en la nube (\textit{cloud computing}), evaluando su idoneidad frente a los requerimientos del proyecto.

\subsection{Requerimientos Clave del Servidor}
\label{subsec:reqs_servidor}

Para cumplir con sus funciones, la plataforma servidora debe satisfacer los siguientes requerimientos técnicos:

\begin{enumerate}
    \item \textbf{Capacidad de Cómputo:} Debe disponer de recursos de CPU (y opcionalmente GPU) suficientes para ejecutar el algoritmo de visión artificial (YOLO) para la detección de residuos en las imágenes recibidas.
    \item \textbf{Almacenamiento Escalable:} Requiere una solución de almacenamiento capaz de gestionar eficientemente tanto los datos estructurados de los sensores (series temporales) como los datos no estructurados (imágenes en formato JPEG).
    \item \textbf{Alta Disponibilidad y Fiabilidad:} El sistema debe operar de forma continua para recibir y procesar los datos de la WSN sin interrupciones.
    \item \textbf{Conectividad de Red:} Debe contar con una conexión a internet estable y de ancho de banda suficiente para recibir los datos del nodo concentrador y servir la interfaz web.
    \item \textbf{Seguridad:} Es imperativo implementar medidas de seguridad para proteger la integridad y confidencialidad de los datos, así como para controlar el acceso a la API.
    \item \textbf{Viabilidad Económica:} La solución debe ser rentable, considerando los costos iniciales y operativos a largo plazo.
\end{enumerate}

\subsection{Comparativa de Modelos de Despliegue}
\label{subsec:modelos_despliegue}

Se evaluaron dos paradigmas fundamentales para la implementación del servidor:

\begin{itemize}
    \item \textbf{Servidor Local (On-Premise):} Implica la adquisición y mantenimiento de hardware físico en una ubicación controlada. El equipo es responsable de la instalación, configuración y seguridad \cite{nordlayer2024}.
        \begin{itemize}
            \item \textit{Ventajas:} Control total sobre el hardware y los datos, lo cual puede ser preferible para cumplir con estrictas normativas de cumplimiento regulatorio \cite{nordlayer2024}.
            \item \textit{Desventajas:} Alta inversión inicial en hardware y licencias, complejidad en la gestión, escalabilidad limitada y necesidad de asegurar la infraestructura de soporte (energía, red) \cite{softteco2024}.
        \end{itemize}
    \item \textbf{Servidor en la Nube (Cloud):} Utiliza un modelo para el acceso bajo demanda a un conjunto compartido de recursos de cómputo configurables que pueden ser rápidamente aprovisionados con un esfuerzo de gestión mínimo \cite{mell2011nist}.
        \begin{itemize}
            \item \textit{Ventajas:} Alta escalabilidad y elasticidad, fiabilidad garantizada por el proveedor (SLA), seguridad robusta y un modelo de costos basado en el pago por uso que elimina la inversión inicial en hardware \cite{softteco2024}.
            \item \textit{Desventajas:} Costos operativos recurrentes y dependencia de la conectividad a internet \cite{softteco2024}.
        \end{itemize}
\end{itemize}

\subsection{Análisis de Proveedores de Servicios en la Nube}
\label{subsec:proveedores_nube}

Dado que el proyecto requiere flexibilidad, escalabilidad y alta disponibilidad, el modelo de servidor en la nube se identifica como el más adecuado. A continuación, se comparan los tres principales proveedores de servicios en la nube, reconocidos como líderes en el sector por analistas de la industria como Gartner \cite{gartner2023magic}.

\input{Documento/Tablas/servidores.tex}


Considerando los requerimientos del proyecto, se selecciona una arquitectura basada en la nube como la solución óptima. Entre los proveedores, \textbf{Amazon Web Services (AWS)} se elige como la plataforma para el desarrollo de este prototipo. La justificación se basa en los siguientes puntos:

\begin{enumerate}
    \item \textbf{Madurez y Ecosistema:} AWS es la plataforma más madura y con la mayor cuota de mercado, ofreciendo el ecosistema de servicios más amplio y una vasta documentación \cite{coursera2024}.
    \item \textbf{Capa Gratuita Robusta:} El \textit{Free Tier} de AWS permite desplegar los recursos necesarios para un prototipo funcional (ej. EC2, S3, RDS) sin costo durante el primer año, lo cual es ideal para un proyecto de tesis \cite{aws2024freetier}.
    \item \textbf{Servicios IoT Integrados:} AWS IoT Core proporciona una solución robusta y bien documentada para gestionar la comunicación desde el nodo concentrador, simplificando la autenticación de dispositivos y la ingesta de datos.
\end{enumerate}

La arquitectura de servicios propuesta en AWS consistiría en:
\begin{itemize}
    \item Un servidor de cómputo virtual (\textbf{Amazon EC2}) para ejecutar el \textit{backend} de la aplicación y el algoritmo de visión artificial.
    \item Un servicio de almacenamiento de objetos (\textbf{Amazon S3}) para el almacenamiento durable de las imágenes capturadas.
    \item Un \textbf{servicio de base de datos gestionada} para la persistencia, integridad y consulta de los datos de los sensores y los metadatos de las imágenes.
    \item Un servicio de conexión de dispositivos (\textbf{AWS IoT Core}) para gestionar la comunicación segura desde el nodo concentrador.
\end{itemize}

La selección específica del motor y el tipo de servicio de base de datos se justifica en detalle en la siguiente sección, basándose en un análisis de los modelos de datos del proyecto.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SECCIÓN: Bases de datos              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Análisis de Base de Datos}
\label{sec:analisis_db}

La base de datos es un componente crítico del servidor, responsable de la persistencia, integridad y disponibilidad de los datos generados por la WSN. La elección de una tecnología de base de datos adecuada impacta directamente en el rendimiento de las consultas, la escalabilidad del sistema y la facilidad con la que se pueden realizar análisis históricos.

\subsection{Requerimientos de la Base de Datos}
\label{subsec:reqs_db}

Con base en la arquitectura del sistema, la base de datos debe cumplir con los siguientes requerimientos específicos:

\begin{enumerate}
    \item \textbf{Manejo de Series Temporales:} El sistema debe almacenar eficientemente las mediciones de los sensores (pH, turbidez, etc.), que son datos de series temporales, caracterizados por tener una marca de tiempo (\textit{timestamp}) y un valor \cite{influxdata2024timeseries}. Esto requiere optimización para inserciones rápidas y consultas complejas basadas en rangos de tiempo.
    \item \textbf{Almacenamiento de Metadatos de Imágenes:} Debe gestionar los metadatos asociados a cada imagen capturada, incluyendo la URL de almacenamiento, la marca de tiempo, la identificación del nodo sensor y los resultados del análisis de visión artificial.
    \item \textbf{Escalabilidad:} La base de datos debe ser capaz de escalar horizontalmente para manejar el volumen creciente de datos a medida que la red de sensores opera a lo largo del tiempo o se expande con nuevos nodos \cite{mongodb2024scalability}.
    \item \textbf{Integridad y Consistencia:} Debe garantizar la integridad de los datos, asegurando que las mediciones se almacenen de forma fiable y consistente, siguiendo principios como los definidos por el modelo ACID en sistemas transaccionales \cite{oracle2024acid}.
    \item \textbf{Rendimiento de Consultas:} El sistema debe permitir consultas de baja latencia para alimentar la interfaz web con datos históricos y en tiempo real.
\end{enumerate}

\subsection{Análisis de Modelos de Base de Datos: SQL vs. NoSQL}
%\label{subsec:modelos_db}

Para satisfacer estos requerimientos, se analizaron los dos modelos de bases de datos predominantes: relacional (SQL) y no relacional (NoSQL).

\begin{itemize}
    \item \textbf{Bases de Datos Relacionales (SQL):} Organizan los datos en tablas estructuradas con un esquema predefinido y son conocidas por su robustez y consistencia (propiedades ACID) \cite{oracle2024sql}. Son muy adecuadas para almacenar los metadatos de las imágenes y las relaciones entre nodos y mediciones \cite{mongodb2024sqlvsnosql}.
    \item \textbf{Bases de Datos No Relacionales (NoSQL):} Utilizan modelos de datos flexibles y priorizan la escalabilidad y la disponibilidad, a menudo siguiendo el modelo BASE (Basically Available, Soft state, Eventually consistent) \cite{mongodb2024sqlvsnosql}. Son ideales para el almacenamiento de datos de series temporales, donde el volumen de inserciones es alto \cite{aws2024sqlvsnosql}.
\end{itemize}

\subsection{Comparativa de Servicios de Base de Datos en AWS}
\label{subsec:comparativa_db_aws}

Dada la selección de AWS como proveedor de nube, se comparan sus servicios de bases de datos gestionadas más relevantes, incluyendo opciones relacionales y una opción especializada en series temporales.

\input{Documento/Tablas/ComparativaBD.tex}

Tras analizar los requerimientos y las plataformas disponibles, se ha decidido optar por una \textbf{arquitectura de base de datos unificada} para simplificar el diseño del sistema, reducir la complejidad operativa y centralizar la gestión de los datos.

La elección se inclina hacia un sistema de gestión de bases de datos relacional (RDBMS), ya que ofrece la versatilidad necesaria para manejar tanto los datos estructurados de los metadatos como las series temporales de los sensores, garantizando al mismo tiempo la máxima integridad de los datos.

Entre las opciones relacionales evaluadas, se selecciona \textbf{Amazon RDS para PostgreSQL} como la plataforma de base de datos única para el proyecto. Esta decisión se fundamenta en los siguientes puntos clave:

\begin{enumerate}
    \item \textbf{Versatilidad y Potencia:} PostgreSQL es conocido por su robustez y su estricto cumplimiento del estándar SQL. Es capaz de gestionar eficientemente los datos relacionales (configuración de nodos, metadatos de imágenes) y, al mismo tiempo, puede ser optimizado para manejar cargas de trabajo de series temporales mediante técnicas avanzadas como la partición de tablas por rangos de fecha y el uso de índices especializados, asegurando un buen rendimiento en las consultas temporales.
    
    \item \textbf{Superioridad para Datos Complejos:} En comparación con MySQL, PostgreSQL ofrece un manejo más avanzado de tipos de datos complejos y un ecosistema de extensiones más rico, como \textbf{PostGIS}, que podría ser crucial en futuras fases del proyecto para realizar análisis geoespaciales sobre la ubicación de los nodos \cite{postgresql2024about}. Esta capacidad de extensión lo convierte en una opción más sólida y preparada para el futuro en aplicaciones científicas y de monitoreo.

    \item \textbf{Viabilidad para el Prototipo:} Amazon Aurora, aunque técnicamente superior en rendimiento, se descarta para esta fase debido a su mayor costo y a que sus capacidades exceden los requerimientos del prototipo. Por su parte, Amazon Timestream se descarta como solución única, ya que su modelo NoSQL no es el adecuado para gestionar las relaciones y la integridad de los metadatos del sistema.
\end{enumerate}

Por lo tanto, Amazon RDS para PostgreSQL representa el balance óptimo entre rendimiento, costo, integridad de los datos y flexibilidad, proporcionando una base sólida y unificada para todas las necesidades de almacenamiento del proyecto.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       SECCIÓN: Arquitectura de Cómputo           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Análisis de Arquitectura de Cómputo para Visión Artificial}
\label{sec:analisis_edge_vs_cloud}

Una decisión de diseño fundamental en cualquier sistema de IoT que integra IA es determinar \textit{dónde} se realizará el procesamiento de los datos. Para la tarea de visión artificial de este proyecto, existen dos paradigmas principales: el cómputo en la nube y el cómputo en el borde \cite{shi2016edge}. A continuación, se analizan ambos enfoques.

\begin{itemize}
    \item \textbf{Cómputo en la Nube (\textit{Cloud Computing}):} En esta arquitectura, el dispositivo en el campo (el nodo sensor) actúa como un simple capturador de datos. Captura la imagen en bruto y la transmite a través de la red a un servidor centralizado y potente en la nube (ej. AWS EC2). Todo el procesamiento intensivo, como la ejecución del modelo YOLO, se realiza en el servidor.
    \begin{itemize}
        \item \textbf{Ventajas:} Permite el uso de modelos de IA muy grandes y precisos, ya que no hay restricciones de hardware. El nodo sensor puede ser más simple, económico y de menor consumo (excepto en la transmisión). La actualización y el mantenimiento del modelo de IA se centralizan en un solo lugar.
        
        \item \textbf{Desventajas:} Requiere un ancho de banda de red significativo y confiable para transmitir datos pesados (imágenes). La transmisión inalámbrica de grandes volúmenes de datos es la operación de mayor consumo energético en un nodo sensor, impactando severamente la autonomía de la batería \cite{Saradha2025comprehensive}.
    \end{itemize}

    \item \textbf{Cómputo en el Borde (\textit{Edge Computing}):} En este enfoque, el procesamiento de los datos se realiza localmente, en o cerca del dispositivo que los captura. El nodo sensor estaría equipado con un microprocesador o un acelerador de IA (ej. un Coral Edge TPU) capaz de ejecutar una versión optimizada y ligera del modelo YOLO (ej. un modelo "cuantizado"), una técnica conocida como \textit{on-device learning} \cite{khouas2024training}.
    \begin{itemize}
        \item \textbf{Ventajas:} Reduce drásticamente el tráfico de red. En lugar de enviar una imagen de \SI{150}{\kilo\byte}, el nodo solo transmite el resultado del análisis (unos pocos bytes de texto, ej. `{"objeto": "botella", "confianza": 0.92}`). Esto se traduce en un ahorro masivo de energía en la comunicación inalámbrica y una mayor vida útil de la batería. También reduce la latencia y permite que el sistema funcione de forma autónoma si se pierde la conexión con el servidor central.
        \item \textbf{Desventajas:} Requiere hardware más potente y costoso en el nodo sensor. Limita el tamaño y la complejidad del modelo de IA que se puede ejecutar, lo que podría reducir la precisión en comparación con un modelo en la nube, ya que el entrenamiento y la inferencia en el borde enfrentan desafíos significativos de recursos.
    \end{itemize}
\end{itemize}

Para la presente fase del proyecto, \textbf{se ha seleccionado la arquitectura de cómputo en la nube}. La justificación se basa en los siguientes criterios:

\begin{enumerate}
    \item \textbf{Flexibilidad y Precisión del Modelo:} El enfoque en la nube permite experimentar con diferentes versiones del modelo YOLO sin estar limitados por el hardware del nodo, priorizando la máxima precisión en la detección de residuos.
    \item \textbf{Simplicidad del Nodo Sensor:} Mantiene el diseño del hardware del nodo más simple y enfocado en la eficiencia energética para la captura y comunicación, lo cual es un desafío de por sí.
    \item \textbf{Viabilidad del Protocolo de Comunicación:} La elección del protocolo Wi-Fi HaLow, con su ancho de banda relativamente alto (comparado con LPWAN como LoRa), hace que la transmisión de imágenes comprimidas sea técnicamente viable, aunque energéticamente costosa.
\end{enumerate}

No obstante, se reconoce que una arquitectura de cómputo en el borde es una optimización altamente deseable. En el capítulo de ``Conclusiones y Trabajo Futuro", se propondrá la exploración de un modelo híbrido o de borde como una evolución natural de este sistema.




\section{Análisis de Modelos para Detección y Segmentación de Objetos}
\label{sec:analisis_vision}

La selección de un algoritmo adecuado para identificar y cuantificar los residuos sólidos flotantes es un componente central de la funcionalidad de visión artificial del sistema. Dada la necesidad de estimar la densidad de basura (posiblemente a través del área cubierta en píxeles), se requiere un modelo capaz no solo de detectar objetos (\textit{object detection}) sino también de delinear sus contornos precisos (\textit{instance segmentation}). La familia de modelos \textbf{YOLO (\textit{You Only Look Once})} ofrece arquitecturas que cubren ambas tareas con un buen balance entre velocidad y precisión \cite{sapkota2025yolo}. Se realizó un análisis comparativo para identificar la versión más apropiada.

\subsection{Criterios de Selección}
\label{subsec:criterios_vision}

La elección del modelo se basa en los siguientes criterios prioritarios:

\begin{enumerate}
    \item \textbf{Precisión (mAP / Mask mAP):} El modelo debe ofrecer alta precisión tanto en la detección (localización con cuadros delimitadores) como, preferiblemente, en la segmentación (delimitación a nivel de píxel). Se toma como referencia el rendimiento en el dataset COCO.
    \item \textbf{Capacidad de Segmentación Integrada:} Se valora positivamente que el modelo soporte la segmentación de instancias de forma nativa dentro de su framework, simplificando el entrenamiento y la inferencia.
    \item \textbf{Tamaño del Modelo y Requerimientos de Hardware:} Aunque el procesamiento se realizará en la nube, se prefiere un modelo con un tamaño razonable para facilitar su despliegue y gestión.
    \item \textbf{Facilidad de Uso y Ecosistema:} Disponibilidad de implementaciones robustas, buena documentación y una comunidad activa.
    \item \textbf{Flexibilidad para Re-entrenamiento:} Capacidad del modelo para ser afinado (\textit{fine-tuning}) con un dataset específico de residuos flotantes.
\end{enumerate}

\subsection{Comparativa de Modelos YOLO Relevantes}
\label{subsec:comparativa_yolo}

La Tabla \ref{tab:comparativa_yolo_condensada} presenta una comparativa de las versiones de YOLO consideradas, destacando su capacidad para la segmentación. Los valores de mAP corresponden al dataset COCO y dependen del hardware \cite{terven2023yolo, sapkota2025yolo}.

\renewcommand{\arraystretch}{1.3}
\begin{longtable}{
    |p{1.6cm}  % Modelo
    |p{1.7cm}         % Precisión
    |p{2.4cm}         % Segmentación
    |p{2.9cm}  % Requerimientos
    |p{2.1cm}         % Facilidad de uso
    |p{3.5cm}| % Ideal para
}
\caption{Comparativa de Modelos YOLO Relevantes (Dataset COCO)} \label{tab:comparativa_yolo_condensada} \\
\hline
\textbf{Modelo} & 
\textbf{Precisión (mAP Det.)} & 
\textbf{Soporte Segmentación Nativo?} & 
\textbf{Requerimientos Hardware (GPU)} & 
\textbf{Facilidad de Uso} & 
\textbf{Ideal Para} \\ 
\hline
\endfirsthead

\hline
\textbf{Modelo} & 
\textbf{Precisión (mAP Det.)} & 
\textbf{Soporte Segmentación Nativo?} & 
\textbf{Requerimientos Hardware (GPU)} & 
\textbf{Facilidad de Uso} & 
\textbf{Ideal Para} \\ 
\hline
\endhead

\hline
\multicolumn{6}{r}{\textit{Continúa en la siguiente página}} \\
\endfoot

\hline
\endlastfoot

YOLOv5 
& $\sim$ 55.8\% (v5x)
& No (Requiere forks/mods)
& Baja/Moderada (Básica a Media)
& Muy Alta (PyTorch Nativo)
& Detección rápida, buen balance, hardware moderado \\ \hline

YOLOv7 
& $\sim$ 56.8\% (v7x)
& No (Principalmente detección)
& Alta (Gama Alta)
& Moderada
& Detección de alta precisión y velocidad \\ \hline

YOLOv8 
& $\sim$ 53.9\% (v8x)
& \textbf{Sí} (Framework Unificado)
& Alta (Gama Alta)
& Muy Alta (Framework Ultralytics)
& \textbf{Detección y Segmentación}, versatilidad, estado del arte \\ \hline

YOLOv11 
& $\sim$ 55.4\% (Est.)
& \textbf{Sí} (Framework Unificado)
& Alta (Gama Alta)
& Alta (Reciente)
& Detección/Segmentación, mejoras arquitectónicas recientes \\ \hline

\multicolumn{6}{p{16cm}}{\footnotesize \textit{Nota: Los tamaños de modelo varían según la versión específica (n, s, m, l, x). El mAP corresponde a COCO val2017 para detección. La facilidad de uso de YOLOv11 puede variar por ser más reciente.}} \\

\end{longtable}


\subsection{Justificación y Selección del Modelo}
\label{subsec:justificacion_yolo}

La necesidad explícita de realizar segmentación de instancias para estimar la densidad de residuos mediante el área cubierta en píxeles inclina la balanza hacia modelos que ofrezcan esta funcionalidad de manera integrada y eficiente.

\begin{itemize}
    \item \textbf{YOLOv5:} Aunque es un modelo excelente y fácil de usar para la detección de objetos \cite{jocher2020yolov5}, no incluye la segmentación de instancias en su rama principal. Lograr segmentación requiere utilizar variantes o modificaciones específicas, lo que añade complejidad al desarrollo y mantenimiento.

    \item \textbf{YOLOv7:} Similar a YOLOv5, su enfoque principal ha sido optimizar la detección en términos de velocidad y precisión, sin integrar la segmentación como una tarea central.

    \item \textbf{YOLOv8:} Desarrollado por Ultralytics, se presenta como un framework unificado que maneja de forma nativa y eficiente tanto la detección como la segmentación de instancias, clasificación y estimación de pose \cite{ultralyticsYOLOv8}. Ofrece un rendimiento de vanguardia, es fácil de usar y cuenta con un excelente soporte y documentación.

    \item \textbf{YOLOv11:} Representa una de las evoluciones más recientes, prometiendo mejoras arquitectónicas \cite{sapkota2025yolo}. Aunque también soporta segmentación, al ser más nuevo, podría tener menos documentación comunitaria o requerir ajustes en las herramientas de entrenamiento en comparación con YOLOv8.
\end{itemize}

Considerando la necesidad de segmentación, la madurez relativa dentro de las arquitecturas modernas y la robustez del framework, se selecciona \textbf{YOLOv8-YOLOv11} como el modelo para este proyecto. Específicamente, se optará por una de sus variantes pre-entrenadas (ej. `yolov8s-seg.pt`) que ya incluye la capacidad de segmentación.

Esta elección ofrece el mejor compromiso entre:
\begin{itemize}
    \item \textbf{Funcionalidad Requerida:} Soporte nativo y eficiente para segmentación de instancias.
    \item \textbf{Precisión:} Rendimiento de vanguardia demostrado en benchmarks estándar.
    \item \textbf{Facilidad de Implementación:} Un framework unificado y bien documentado que simplifica el entrenamiento (fine-tuning) y la inferencia.
\end{itemize}

Si bien YOLOv5 sigue siendo una excelente opción si la detección simple fuese suficiente, la necesidad de cuantificar el área cubierta por los residuos hace que YOLOv8 sea la opción técnicamente superior para los objetivos planteados.





